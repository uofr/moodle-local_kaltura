{"version":3,"sources":["../src/upload_form_record.js"],"names":["root","stream","recorder","file","constraints","video","deviceId","audio","CSS","HIDDEN","ACTIVE","NO_STREAM","RECORDING","RECORDING_DONE","ERROR","NotAllowedError","title","key","component","message","NotFoundError","NotReadableError","SELECTORS","NAME","TAGS","DESC","TERM","STUDENT_CONTENT","RECORDER","PREVIEW","PREVIEW_BUTTON","RECORD_BUTTON","STOP_BUTTON","TIME","AUDIO_OPTIONS","VIDEO_OPTIONS","SWITCH_DEVICE","DEVICE_OPTION","UPLOAD_PART_2","TEMPLATES","DISMISSABLE_ALERT","DEVICE_OPTIONS","init","rootSelector","registerEventListeners","startStream","KalturaEvents","mediaStreamStart","previewStream","updateDeviceOptions","navigator","mediaDevices","addEventListener","on","e","deviceOption","currentTarget","deviceType","attr","parent","find","removeClass","addClass","stopStream","startRecording","stopRecording","preventDefault","upload","prop","uploadModalClose","val","getUserMedia","errorHandler","preview","getTracks","track","stop","srcObject","MediaRecorder","ondataavailable","previewVideo","URL","createObjectURL","data","onstart","toggleClass","KalturaTimer","startTimer","updateTime","getTime","onstop","stopTimer","onerror","error","start","autoplay","controls","muted","src","revokeObjectURL","url","time","text","name","Notification","exception","renderAlert","Templates","render","then","html","js","prependNodeContents","catch","enumerateDevices","devices","audioDevices","filter","device","kind","videoDevices","tracks","audioDeviceId","getSettings","videoDeviceId","activeAudioIndex","findIndex","activeVideoIndex","selected","replaceNodeContents","formData","getFormData","Promise","all","KalturaAjax","getUploadCredentials","ModalFactory","create","type","ModalKalturaProgress","getType","uploadCredentials","progressModal","show","KalturaUploader","progressCallback","xml","newEntryId","uploadComplete","hide","destroy","trim","tags","desc","studentContent","term","assessment"],"mappings":"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","sourcesContent":["import $ from 'jquery';\nimport Notification from 'core/notification';\nimport {subscribe, publish} from 'core/pubsub';\nimport {get_strings as getStrings} from 'core/str';\nimport Templates from 'core/templates';\n\nimport ModalFactory from 'core/modal_factory';\nimport ModalKalturaProgress from 'local_kaltura/modal_kaltura_progress';\n\nimport KalturaAjax from 'local_kaltura/kaltura_ajax';\nimport KalturaUploader from 'local_kaltura/kaltura_uploader';\nimport KalturaTimer from 'local_kaltura/kaltura_timer';\nimport KalturaEvents from 'local_kaltura/kaltura_events';\n\nlet root;\nlet stream;\nlet recorder;\nlet file;\nlet constraints = {\n    video: {deviceId: undefined},\n    audio: {deviceId: undefined}\n};\n\nconst CSS = {\n    HIDDEN: 'hidden',\n    ACTIVE: 'active',\n    NO_STREAM: 'kaltura-no-stream',\n    RECORDING: 'kaltura-recording',\n    RECORDING_DONE: 'kaltura-recording-complete'\n};\n\nconst ERROR = {\n    NotAllowedError: {\n        title: {key: 'not_allowed_hdr', component: 'local_kaltura'},\n        message: {key: 'not_allowed', component: 'local_kaltura'}\n    },\n    NotFoundError: {\n        title: {key: 'not_found_hdr', component: 'local_kaltura'},\n        message: {key: 'not_found', component: 'local_kaltura'}\n    },\n    NotReadableError: {\n        title: {key: 'not_readable_hdr', component: 'local_kaltura'},\n        message: {key: 'not_readable', component: 'local_kaltura'}\n    }\n};\n\nconst SELECTORS = {\n    NAME: '#entry_name',\n    TAGS: '#entry_tags',\n    DESC: '#entry_desc',\n    TERM: '#entry_term',\n    STUDENT_CONTENT: '[name=\"student\"]',\n    RECORDER: '[data-region=\"kaltura-recorder\"]',\n    PREVIEW: '#entry_preview',\n    PREVIEW_BUTTON: '[data-action=\"start-preview\"]',\n    RECORD_BUTTON: '[data-action=\"start-recording\"]',\n    STOP_BUTTON: '[data-action=\"stop-recording\"]',\n    TIME: '[data-region=\"kaltura-recorder-time\"]',\n    AUDIO_OPTIONS: '[data-region=\"audio-options\"]',\n    VIDEO_OPTIONS: '[data-region=\"video-options\"]',\n    SWITCH_DEVICE: '[data-action=\"switch-device\"]:not(.active)',\n    DEVICE_OPTION: '[data-action=\"switch-device\"]',\n    UPLOAD_PART_2: '[data-region=\"upload-part-2\"]'\n};\n\nconst TEMPLATES = {\n    DISMISSABLE_ALERT: 'local_kaltura/kaltura_dismissable_alert',\n    DEVICE_OPTIONS: 'local_kaltura/kaltura_device_options'\n};\n\nexport const init = async (rootSelector) => {\n    root = $(rootSelector);\n    registerEventListeners();\n    startStream();\n};\n\nconst registerEventListeners = () => {\n    subscribe(KalturaEvents.mediaStreamStart, (stream) => {\n        previewStream(stream);\n        updateDeviceOptions();\n    });\n\n    navigator.mediaDevices.addEventListener('devicechange', () => {\n        updateDeviceOptions();\n    });\n\n    root.on('click', SELECTORS.SWITCH_DEVICE, async (e) => {\n        const deviceOption = $(e.currentTarget);\n        const deviceType = deviceOption.attr('data-device-type');\n        const deviceId = deviceOption.attr('data-device-id');\n        deviceOption.parent().find(SELECTORS.DEVICE_OPTION).removeClass(CSS.ACTIVE);\n        deviceOption.addClass(CSS.ACTIVE);\n        if (deviceType === 'audioinput') {\n            constraints.audio.deviceId = deviceId;\n        } else if (deviceType === 'videoinput') {\n            constraints.video.deviceId = deviceId;\n        }\n        stopStream();\n        await startStream();\n    });\n\n\n    root.on('click', SELECTORS.RECORD_BUTTON, () => {\n        if (!stream) return;\n        startRecording(stream);\n    });\n\n    root.on('click', SELECTORS.PREVIEW_BUTTON, () => {\n        startStream();\n    });\n\n    root.on('click', SELECTORS.STOP_BUTTON, () => {\n        stopRecording();\n    });\n\n    root.on('submit', (e) => {\n        e.preventDefault();\n        upload();\n    });\n\n    root.on('reset', () => {\n        root.find(SELECTORS.UPLOAD_PART_2).addClass(CSS.HIDDEN);\n        root.find(SELECTORS.TERM).prop('disabled', false);\n        root.removeClass(CSS.RECORDING_DONE);\n        file = null;\n        startStream();\n    });\n\n    subscribe(KalturaEvents.uploadModalClose, () => {\n        if (stream) {\n            stopStream();\n        }\n    });\n\n    root.on('change', SELECTORS.STUDENT_CONTENT, (e) => {\n        root.find(SELECTORS.TERM).prop('disabled', $(e.currentTarget).val() === 'Yes');\n    });\n};\n\nconst startStream = async () => {\n    try {\n        stream = await navigator.mediaDevices.getUserMedia(constraints);\n        root.removeClass(CSS.NO_STREAM);\n        publish(KalturaEvents.mediaStreamStart, stream);\n    } catch (error) {\n        root.addClass(CSS.NO_STREAM);\n        errorHandler(error);\n    }\n};\n\nconst stopStream = () => {\n    const preview = $(SELECTORS.PREVIEW)[0];\n    for (const track of stream.getTracks()) {\n        track.stop();\n    }\n    stream = null;\n    preview.srcObject = null;\n};\n\nconst startRecording = (stream) => {\n    try {\n        recorder = new MediaRecorder(stream);\n        recorder.ondataavailable = (e) => {\n            stopStream();\n            previewVideo(URL.createObjectURL(e.data));\n            file = e.data;\n            $(SELECTORS.UPLOAD_PART_2).removeClass(CSS.HIDDEN);\n        };\n        recorder.onstart = () => {\n            root.toggleClass(CSS.RECORDING, true);\n            $(SELECTORS.UPLOAD_PART_2).toggleClass(CSS.HIDDEN, true);\n            KalturaTimer.startTimer(() => {\n                updateTime(KalturaTimer.getTime());\n            });\n        };\n        recorder.onstop = () => {\n            root.toggleClass(CSS.RECORDING, false);\n            root.toggleClass(CSS.RECORDING_DONE, true);\n            KalturaTimer.stopTimer();\n            updateTime('00:00');\n        };\n        recorder.onerror = (e) => {\n            errorHandler(e.error);\n        };\n        recorder.start();\n    } catch (error) {\n        errorHandler(error);\n    }\n};\n\nconst stopRecording = () => {\n    recorder.stop();\n};\n\nconst previewStream = (stream) => {\n    const preview = $(SELECTORS.PREVIEW)[0];\n    preview.autoplay = true;\n    preview.controls = false;\n    preview.muted = true;\n    if (preview.src) {\n        URL.revokeObjectURL(preview.src);\n        preview.src = null;\n    }\n    preview.srcObject = stream;\n\n};\n\nconst previewVideo = (url) => {\n    const preview = $(SELECTORS.PREVIEW)[0];\n    preview.src = url;\n    preview.autoplay = false;\n    preview.controls = true;\n    preview.muted = false;\n};\n\nconst updateTime = (time) => {\n    $(SELECTORS.TIME).text(time);\n};\n\nconst errorHandler = async (error) => {\n    if (!ERROR[error.name]) {\n        Notification.exception(error);\n        return;\n    }\n    const [title, message] = await getStrings([\n        ERROR[error.name].title,\n        ERROR[error.name].message\n    ]);\n    renderAlert(title, message);\n};\n\nconst renderAlert = (title, message) => {\n    return Templates.render(TEMPLATES.DISMISSABLE_ALERT, {\n        title: title,\n        message: message\n    })\n    .then((html, js) => Templates.prependNodeContents(SELECTORS.RECORDER, html, js))\n    .catch(Notification.exception);\n};\n\nconst updateDeviceOptions = async () => {\n    const devices = await navigator.mediaDevices.enumerateDevices();\n    const audioDevices = devices.filter(device => device.kind === 'audioinput');\n    const videoDevices = devices.filter(device => device.kind === 'videoinput');\n\n    const tracks = stream.getTracks();\n    const audioDeviceId = tracks.find(track => track.kind === 'audio').getSettings().deviceId;\n    const videoDeviceId = tracks.find(track => track.kind === 'video').getSettings().deviceId;\n\n    const activeAudioIndex = audioDevices.findIndex(device => device.deviceId === audioDeviceId);\n    const activeVideoIndex = videoDevices.findIndex(device => device.deviceId === videoDeviceId);\n\n    audioDevices[activeAudioIndex].selected = true;\n    videoDevices[activeVideoIndex].selected = true;\n\n    Templates.render(TEMPLATES.DEVICE_OPTIONS, {devices: audioDevices})\n        .then((html, js) => Templates.replaceNodeContents(SELECTORS.AUDIO_OPTIONS, html, js))\n        .catch(Notification.exception);\n\n    Templates.render(TEMPLATES.DEVICE_OPTIONS, {devices: videoDevices})\n        .then((html, js) => Templates.replaceNodeContents(SELECTORS.VIDEO_OPTIONS, html, js))\n        .catch(Notification.exception);\n};\n\nconst upload = async () => {\n    let uploadCredentials, progressModal;\n\n    try {\n        const formData = getFormData();\n        [uploadCredentials, progressModal] = await Promise.all([\n            KalturaAjax.getUploadCredentials(),\n            ModalFactory.create({type: ModalKalturaProgress.getType()})\n        ]);\n        progressModal.show();\n        const xml = await KalturaUploader.upload(formData, uploadCredentials, progressModal.progressCallback);\n        const newEntryId = $(xml).find('entryId').text();\n        publish(KalturaEvents.uploadComplete, newEntryId);\n    } catch (error) {\n        Notification.exception(error);\n    } finally {\n        progressModal.hide();\n        progressModal.destroy();\n    }\n};\n\nconst getFormData = () => {\n    return {\n        file: file,\n        name: root.find(SELECTORS.NAME).val().trim(),\n        tags: root.find(SELECTORS.TAGS).val().trim(),\n        desc: root.find(SELECTORS.DESC).val().trim(),\n        studentContent: root.find(SELECTORS.STUDENT_CONTENT + ':checked').val(),\n        term: root.find(SELECTORS.STUDENT_CONTENT + ':checked').val() === 'Yes' ? '' : root.find(SELECTORS.TERM).val(),\n        assessment: 'No'\n    };\n};"],"file":"upload_form_record.min.js"}