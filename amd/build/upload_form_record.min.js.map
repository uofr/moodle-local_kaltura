{"version":3,"sources":["../src/upload_form_record.js"],"names":["root","stream","recorder","file","constraints","video","deviceId","audio","CSS","HIDDEN","ACTIVE","NO_STREAM","RECORDING","RECORDING_DONE","ERROR","NotAllowedError","title","key","component","message","NotFoundError","NotReadableError","SELECTORS","NAME","TAGS","DESC","TERM","STUDENT_CONTENT","RECORDER","PREVIEW","PREVIEW_BUTTON","RECORD_BUTTON","STOP_BUTTON","TIME","AUDIO_OPTIONS","VIDEO_OPTIONS","SWITCH_DEVICE","DEVICE_OPTION","UPLOAD_PART_2","KALTURA_RECORDER_ERROR","TEMPLATES","RECORDER_ALERT","DEVICE_OPTIONS","init","rootSelector","registerEventListeners","startStream","navigator","mediaDevices","addEventListener","updateDeviceOptions","on","e","deviceOption","currentTarget","deviceType","attr","parent","find","removeClass","addClass","stopStream","startRecording","stopRecording","preventDefault","upload","resetPreview","hideError","prop","KalturaEvents","uploadModalClose","val","getUserMedia","previewStream","errorHandler","preview","getTracks","track","stop","srcObject","MediaRecorder","ondataavailable","previewVideo","URL","createObjectURL","data","onstart","toggleClass","KalturaTimer","startTimer","updateTime","getTime","onstop","stopTimer","onerror","Notification","exception","error","start","autoplay","controls","muted","src","revokeObjectURL","url","time","text","remove","name","renderAlert","Templates","render","then","html","js","prependNodeContents","catch","enumerateDevices","devices","audioDevices","filter","device","kind","videoDevices","active","tracks","audioDeviceId","getSettings","videoDeviceId","activeAudioIndex","findIndex","activeVideoIndex","selected","replaceNodeContents","formData","getFormData","Promise","all","KalturaAjax","getUploadCredentials","ModalFactory","create","type","ModalKalturaProgress","getType","uploadCredentials","progressModal","show","KalturaUploader","progressCallback","xml","newEntryId","uploadComplete","hide","destroy","trim","tags","desc","studentContent","term","assessment"],"mappings":"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","sourcesContent":["import $ from 'jquery';\nimport Notification from 'core/notification';\nimport {subscribe, publish} from 'core/pubsub';\nimport {get_strings as getStrings} from 'core/str';\nimport Templates from 'core/templates';\n\nimport ModalFactory from 'core/modal_factory';\nimport ModalKalturaProgress from 'local_kaltura/modal_kaltura_progress';\n\nimport KalturaAjax from 'local_kaltura/kaltura_ajax';\nimport KalturaUploader from 'local_kaltura/kaltura_uploader';\nimport KalturaTimer from 'local_kaltura/kaltura_timer';\nimport KalturaEvents from 'local_kaltura/kaltura_events';\n\nlet root;\nlet stream;\nlet recorder;\nlet file;\nlet constraints = {\n    video: {deviceId: undefined},\n    audio: {deviceId: undefined}\n};\n\nconst CSS = {\n    HIDDEN: 'hidden',\n    ACTIVE: 'active',\n    NO_STREAM: 'kaltura-no-stream',\n    RECORDING: 'kaltura-recording',\n    RECORDING_DONE: 'kaltura-recording-complete'\n};\n\nconst ERROR = {\n    NotAllowedError: {\n        title: {key: 'not_allowed_hdr', component: 'local_kaltura'},\n        message: {key: 'not_allowed', component: 'local_kaltura'}\n    },\n    NotFoundError: {\n        title: {key: 'not_found_hdr', component: 'local_kaltura'},\n        message: {key: 'not_found', component: 'local_kaltura'}\n    },\n    NotReadableError: {\n        title: {key: 'not_readable_hdr', component: 'local_kaltura'},\n        message: {key: 'not_readable', component: 'local_kaltura'}\n    }\n};\n\nconst SELECTORS = {\n    NAME: '#entry_name',\n    TAGS: '#entry_tags',\n    DESC: '#entry_desc',\n    TERM: '#entry_term',\n    STUDENT_CONTENT: '[name=\"student\"]',\n    RECORDER: '[data-region=\"kaltura-recorder\"]',\n    PREVIEW: '#entry_preview',\n    PREVIEW_BUTTON: '[data-action=\"start-preview\"]',\n    RECORD_BUTTON: '[data-action=\"start-recording\"]',\n    STOP_BUTTON: '[data-action=\"stop-recording\"]',\n    TIME: '[data-region=\"kaltura-recorder-time\"]',\n    AUDIO_OPTIONS: '[data-region=\"audio-options\"]',\n    VIDEO_OPTIONS: '[data-region=\"video-options\"]',\n    SWITCH_DEVICE: '[data-action=\"switch-device\"]:not(.active)',\n    DEVICE_OPTION: '[data-action=\"switch-device\"]',\n    UPLOAD_PART_2: '[data-region=\"upload-part-2\"]',\n    KALTURA_RECORDER_ERROR: '.kaltura-recorder-alert'\n};\n\nconst TEMPLATES = {\n    RECORDER_ALERT: 'local_kaltura/kaltura_recorder_alert',\n    DEVICE_OPTIONS: 'local_kaltura/kaltura_device_options'\n};\n\nexport const init = (rootSelector) => {\n    root = $(rootSelector);\n    registerEventListeners();\n    startStream();\n};\n\nconst registerEventListeners = () => {\n    navigator.mediaDevices.addEventListener('devicechange', () => {\n        updateDeviceOptions();\n    });\n\n    root.on('click', SELECTORS.SWITCH_DEVICE, async (e) => {\n        const deviceOption = $(e.currentTarget);\n        const deviceType = deviceOption.attr('data-device-type');\n        const deviceId = deviceOption.attr('data-device-id');\n        deviceOption.parent().find(SELECTORS.DEVICE_OPTION).removeClass(CSS.ACTIVE);\n        deviceOption.addClass(CSS.ACTIVE);\n        if (deviceType === 'audioinput') {\n            constraints.audio.deviceId = deviceId;\n        } else if (deviceType === 'videoinput') {\n            constraints.video.deviceId = deviceId;\n        }\n        stopStream();\n        await startStream();\n    });\n\n\n    root.on('click', SELECTORS.RECORD_BUTTON, () => {\n        if (!stream) return;\n        startRecording(stream);\n    });\n\n    root.on('click', SELECTORS.PREVIEW_BUTTON, () => {\n        startStream();\n    });\n\n    root.on('click', SELECTORS.STOP_BUTTON, () => {\n        stopRecording();\n    });\n\n    root.on('submit', (e) => {\n        e.preventDefault();\n        upload();\n    });\n\n    root.on('reset', () => {\n        resetPreview();\n        hideError();\n        root.find(SELECTORS.UPLOAD_PART_2).addClass(CSS.HIDDEN);\n        root.find(SELECTORS.TERM).prop('disabled', false);\n        root.removeClass(CSS.RECORDING_DONE);\n        file = null;\n        startStream();\n    });\n\n    subscribe(KalturaEvents.uploadModalClose, () => {\n        if (stream) {\n            stopStream();\n        }\n    });\n\n    root.on('change', SELECTORS.STUDENT_CONTENT, (e) => {\n        root.find(SELECTORS.TERM).prop('disabled', $(e.currentTarget).val() === 'Yes');\n    });\n};\n\nconst startStream = async () => {\n    try {\n        stream = await navigator.mediaDevices.getUserMedia(constraints);\n        updateDeviceOptions();\n        previewStream(stream);\n        root.removeClass(CSS.NO_STREAM);\n        hideError();\n    } catch (error) {\n        root.addClass(CSS.NO_STREAM);\n        errorHandler(error);\n    }\n};\n\nconst stopStream = () => {\n    const preview = root.find(SELECTORS.PREVIEW)[0];\n    for (const track of stream.getTracks()) {\n        track.stop();\n    }\n    stream = null;\n    if (preview) {\n        preview.srcObject = null;\n    }\n};\n\nconst startRecording = (stream) => {\n    try {\n        recorder = new MediaRecorder(stream);\n        recorder.ondataavailable = (e) => {\n            stopStream();\n            previewVideo(URL.createObjectURL(e.data));\n            file = e.data;\n            $(SELECTORS.UPLOAD_PART_2).removeClass(CSS.HIDDEN);\n        };\n        recorder.onstart = () => {\n            root.toggleClass(CSS.RECORDING, true);\n            $(SELECTORS.UPLOAD_PART_2).toggleClass(CSS.HIDDEN, true);\n            KalturaTimer.startTimer(() => {\n                updateTime(KalturaTimer.getTime());\n            });\n        };\n        recorder.onstop = () => {\n            root.toggleClass(CSS.RECORDING, false);\n            root.toggleClass(CSS.RECORDING_DONE, true);\n            KalturaTimer.stopTimer();\n            updateTime('00:00');\n        };\n        recorder.onerror = (e) => {\n            Notification.exception(e.error);\n        };\n        recorder.start();\n    } catch (error) {\n        Notification.exception(error);\n    }\n};\n\nconst stopRecording = () => {\n    recorder.stop();\n};\n\nconst previewStream = (stream) => {\n    const preview = $(SELECTORS.PREVIEW)[0];\n    preview.autoplay = true;\n    preview.controls = false;\n    preview.muted = true;\n    if (preview.src) {\n        URL.revokeObjectURL(preview.src);\n        preview.src = null;\n    }\n    preview.srcObject = stream;\n};\n\nconst previewVideo = (url) => {\n    const preview = $(SELECTORS.PREVIEW)[0];\n    preview.src = url;\n    preview.autoplay = false;\n    preview.controls = true;\n    preview.muted = false;\n};\n\nconst resetPreview = () => {\n    const preview = $(SELECTORS.PREVIEW)[0];\n    preview.autoplay = true;\n    preview.controls = false;\n    preview.muted = true;\n    if (preview.src) {\n        URL.revokeObjectURL(preview.src);\n        preview.src = null;\n    }\n    preview.srcObject = null;\n};\n\nconst updateTime = (time) => {\n    $(SELECTORS.TIME).text(time);\n};\n\nconst hideError = () => {\n    root.find(SELECTORS.KALTURA_RECORDER_ERROR).remove();\n};\n\nconst errorHandler = async (error) => {\n    if (!ERROR[error.name]) {\n        Notification.exception(error);\n        return;\n    }\n    const [title, message] = await getStrings([\n        ERROR[error.name].title,\n        ERROR[error.name].message\n    ]);\n    renderAlert(title, message);\n};\n\nconst renderAlert = (title, message) => {\n    return Templates.render(TEMPLATES.RECORDER_ALERT, {\n        title: title,\n        message: message\n    })\n    .then((html, js) => Templates.prependNodeContents(SELECTORS.RECORDER, html, js))\n    .catch(Notification.exception);\n};\n\nconst updateDeviceOptions = async () => {\n    const devices = await navigator.mediaDevices.enumerateDevices();\n    const audioDevices = devices.filter(device => device.kind === 'audioinput');\n    const videoDevices = devices.filter(device => device.kind === 'videoinput');\n\n    if (stream && stream.active) {\n        const tracks = stream.getTracks();\n        const audioDeviceId = tracks.find(track => track.kind === 'audio').getSettings().deviceId;\n        const videoDeviceId = tracks.find(track => track.kind === 'video').getSettings().deviceId;\n\n        const activeAudioIndex = audioDevices.findIndex(device => device.deviceId === audioDeviceId);\n        const activeVideoIndex = videoDevices.findIndex(device => device.deviceId === videoDeviceId);\n\n        audioDevices[activeAudioIndex].selected = true;\n        videoDevices[activeVideoIndex].selected = true;\n    }\n\n    Templates.render(TEMPLATES.DEVICE_OPTIONS, {devices: audioDevices})\n        .then((html, js) => Templates.replaceNodeContents(SELECTORS.AUDIO_OPTIONS, html, js))\n        .catch(Notification.exception);\n\n    Templates.render(TEMPLATES.DEVICE_OPTIONS, {devices: videoDevices})\n        .then((html, js) => Templates.replaceNodeContents(SELECTORS.VIDEO_OPTIONS, html, js))\n        .catch(Notification.exception);\n};\n\nconst upload = async () => {\n    let uploadCredentials, progressModal;\n\n    try {\n        const formData = getFormData();\n        [uploadCredentials, progressModal] = await Promise.all([\n            KalturaAjax.getUploadCredentials(),\n            ModalFactory.create({type: ModalKalturaProgress.getType()})\n        ]);\n        progressModal.show();\n        const xml = await KalturaUploader.upload(formData, uploadCredentials, progressModal.progressCallback);\n        const newEntryId = $(xml).find('entryId').text();\n        publish(KalturaEvents.uploadComplete, newEntryId);\n    } catch (error) {\n        Notification.exception(error);\n    } finally {\n        progressModal.hide();\n        progressModal.destroy();\n    }\n};\n\nconst getFormData = () => {\n    return {\n        file: file,\n        name: root.find(SELECTORS.NAME).val().trim(),\n        tags: root.find(SELECTORS.TAGS).val().trim(),\n        desc: root.find(SELECTORS.DESC).val().trim(),\n        studentContent: root.find(SELECTORS.STUDENT_CONTENT + ':checked').val(),\n        term: root.find(SELECTORS.STUDENT_CONTENT + ':checked').val() === 'Yes' ? '' : root.find(SELECTORS.TERM).val(),\n        assessment: 'No'\n    };\n};"],"file":"upload_form_record.min.js"}