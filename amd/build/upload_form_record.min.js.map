{"version":3,"sources":["../src/upload_form_record.js"],"names":["root","stream","recorder","file","constraints","video","deviceId","audio","CSS","HIDDEN","ACTIVE","NO_STREAM","RECORDING","RECORDING_DONE","ERROR","NotAllowedError","title","key","component","message","NotFoundError","NotReadableError","SELECTORS","NAME","TAGS","DESC","TERM","STUDENT_CONTENT","RECORDER","PREVIEW","PREVIEW_BUTTON","RECORD_BUTTON","STOP_BUTTON","TIME","AUDIO_OPTIONS","VIDEO_OPTIONS","SWITCH_DEVICE","DEVICE_OPTION","UPLOAD_PART_2","TEMPLATES","DISMISSABLE_ALERT","DEVICE_OPTIONS","init","rootSelector","startStream","updateDeviceOptions","registerEventListeners","on","e","deviceOption","currentTarget","deviceType","attr","parent","find","removeClass","addClass","stopStream","startRecording","stopRecording","preventDefault","upload","prop","KalturaEvents","uploadModalClose","val","preview","autoplay","controls","muted","src","URL","revokeObjectURL","navigator","mediaDevices","getUserMedia","srcObject","errorHandler","getTracks","track","stop","MediaRecorder","ondataavailable","previewVideo","createObjectURL","data","onstart","toggleClass","KalturaTimer","startTimer","updateTime","getTime","onstop","stopTimer","onerror","error","start","url","time","text","name","Notification","exception","renderAlert","Templates","render","then","html","js","prependNodeContents","catch","enumerateDevices","devices","audioDevices","filter","device","kind","selected","videoDevices","replaceNodeContents","formData","getFormData","Promise","all","KalturaAjax","getUploadCredentials","ModalFactory","create","type","ModalKalturaProgress","getType","uploadCredentials","progressModal","show","KalturaUploader","progressCallback","xml","newEntryId","uploadComplete","hide","destroy","trim","tags","desc","studentContent","term","assessment"],"mappings":"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","sourcesContent":["import $ from 'jquery';\nimport Notification from 'core/notification';\nimport {subscribe, publish} from 'core/pubsub';\nimport {get_strings as getStrings} from 'core/str';\nimport Templates from 'core/templates';\n\nimport ModalFactory from 'core/modal_factory';\nimport ModalKalturaProgress from 'local_kaltura/modal_kaltura_progress';\n\nimport KalturaAjax from 'local_kaltura/kaltura_ajax';\nimport KalturaUploader from 'local_kaltura/kaltura_uploader';\nimport KalturaTimer from 'local_kaltura/kaltura_timer';\nimport KalturaEvents from 'local_kaltura/kaltura_events';\n\nlet root;\nlet stream;\nlet recorder;\nlet file;\nlet constraints = {\n    video: {deviceId: undefined},\n    audio: {deviceId: undefined}\n};\n\nconst CSS = {\n    HIDDEN: 'hidden',\n    ACTIVE: 'active',\n    NO_STREAM: 'kaltura-no-stream',\n    RECORDING: 'kaltura-recording',\n    RECORDING_DONE: 'kaltura-recording-complete'\n};\n\nconst ERROR = {\n    NotAllowedError: {\n        title: {key: 'not_allowed_hdr', component: 'local_kaltura'},\n        message: {key: 'not_allowed', component: 'local_kaltura'}\n    },\n    NotFoundError: {\n        title: {key: 'not_found_hdr', component: 'local_kaltura'},\n        message: {key: 'not_found', component: 'local_kaltura'}\n    },\n    NotReadableError: {\n        title: {key: 'not_readable_hdr', component: 'local_kaltura'},\n        message: {key: 'not_readable', component: 'local_kaltura'}\n    }\n};\n\nconst SELECTORS = {\n    NAME: '#entry_name',\n    TAGS: '#entry_tags',\n    DESC: '#entry_desc',\n    TERM: '#entry_term',\n    STUDENT_CONTENT: '[name=\"student\"]',\n    RECORDER: '[data-region=\"kaltura-recorder\"]',\n    PREVIEW: '#entry_preview',\n    PREVIEW_BUTTON: '[data-action=\"start-preview\"]',\n    RECORD_BUTTON: '[data-action=\"start-recording\"]',\n    STOP_BUTTON: '[data-action=\"stop-recording\"]',\n    TIME: '[data-region=\"kaltura-recorder-time\"]',\n    AUDIO_OPTIONS: '[data-region=\"audio-options\"]',\n    VIDEO_OPTIONS: '[data-region=\"video-options\"]',\n    SWITCH_DEVICE: '[data-action=\"switch-device\"]:not(.active)',\n    DEVICE_OPTION: '[data-action=\"switch-device\"]',\n    UPLOAD_PART_2: '[data-region=\"upload-part-2\"]'\n};\n\nconst TEMPLATES = {\n    DISMISSABLE_ALERT: 'local_kaltura/kaltura_dismissable_alert',\n    DEVICE_OPTIONS: 'local_kaltura/kaltura_device_options'\n};\n\nexport const init = async (rootSelector) => {\n    root = $(rootSelector);\n    await startStream();\n    await updateDeviceOptions();\n    registerEventListeners();\n};\n\nconst registerEventListeners = () => {\n    root.on('click', SELECTORS.SWITCH_DEVICE, async (e) => {\n        const deviceOption = $(e.currentTarget);\n        const deviceType = deviceOption.attr('data-device-type');\n        const deviceId = deviceOption.attr('data-device-id');\n        deviceOption.parent().find(SELECTORS.DEVICE_OPTION).removeClass(CSS.ACTIVE);\n        deviceOption.addClass(CSS.ACTIVE);\n        if (deviceType === 'audioinput') {\n            constraints.audio.deviceId = deviceId;\n        } else if (deviceType === 'videoinput') {\n            constraints.video.deviceId = deviceId;\n        }\n        stopStream();\n        await startStream();\n    });\n\n    root.on('click', SELECTORS.RECORD_BUTTON, () => {\n        if (!stream) return;\n        startRecording(stream);\n    });\n\n    root.on('click', SELECTORS.PREVIEW_BUTTON, () => {\n        startStream();\n    });\n\n    root.on('click', SELECTORS.STOP_BUTTON, () => {\n        stopRecording();\n    });\n\n    root.on('submit', (e) => {\n        e.preventDefault();\n        upload();\n    });\n\n    root.on('reset', () => {\n        root.find(SELECTORS.UPLOAD_PART_2).addClass(CSS.HIDDEN);\n        root.find(SELECTORS.TERM).prop('disabled', false);\n        root.removeClass(CSS.RECORDING_DONE);\n        file = null;\n        startStream();\n    });\n\n    subscribe(KalturaEvents.uploadModalClose, () => {\n        if (stream) {\n            stopStream();\n        }\n    });\n\n    root.on('change', SELECTORS.STUDENT_CONTENT, (e) => {\n        root.find(SELECTORS.TERM).prop('disabled', $(e.currentTarget).val() === 'Yes');\n    });\n};\n\nconst startStream = async () => {\n    try {\n        const preview = $(SELECTORS.PREVIEW)[0];\n        preview.autoplay = true;\n        preview.controls = false;\n        preview.muted = true;\n        if (preview.src) {\n            URL.revokeObjectURL(preview.src);\n            preview.src = null;\n        }\n        stream = await navigator.mediaDevices.getUserMedia(constraints);\n        preview.srcObject = stream;\n        root.removeClass(CSS.NO_STREAM);\n    } catch (error) {\n        errorHandler(error);\n        root.addClass(CSS.NO_STREAM);\n    }\n};\n\nconst stopStream = () => {\n    const preview = $(SELECTORS.PREVIEW)[0];\n    for (const track of stream.getTracks()) {\n        track.stop();\n    }\n    stream = null;\n    preview.srcObject = null;\n};\n\nconst startRecording = (stream) => {\n    try {\n        recorder = new MediaRecorder(stream);\n        recorder.ondataavailable = (e) => {\n            stopStream();\n            previewVideo(URL.createObjectURL(e.data));\n            file = e.data;\n            $(SELECTORS.UPLOAD_PART_2).removeClass(CSS.HIDDEN);\n        };\n        recorder.onstart = () => {\n            root.toggleClass(CSS.RECORDING, true);\n            $(SELECTORS.UPLOAD_PART_2).toggleClass(CSS.HIDDEN, true);\n            KalturaTimer.startTimer(() => {\n                updateTime(KalturaTimer.getTime());\n            });\n        };\n        recorder.onstop = () => {\n            root.toggleClass(CSS.RECORDING, false);\n            root.toggleClass(CSS.RECORDING_DONE, true);\n            KalturaTimer.stopTimer();\n            updateTime('00:00');\n        };\n        recorder.onerror = (e) => {\n            errorHandler(e.error);\n        };\n        recorder.start();\n    } catch (error) {\n        errorHandler(error);\n    }\n};\n\nconst stopRecording = () => {\n    recorder.stop();\n};\n\nconst previewVideo = (url) => {\n    const preview = $(SELECTORS.PREVIEW)[0];\n    preview.src = url;\n    preview.autoplay = false;\n    preview.controls = true;\n    preview.muted = false;\n};\n\nconst updateTime = (time) => {\n    $(SELECTORS.TIME).text(time);\n};\n\nconst errorHandler = async (error) => {\n    if (!ERROR[error.name]) {\n        Notification.exception(error);\n        return;\n    }\n    const [title, message] = await getStrings([\n        ERROR[error.name].title,\n        ERROR[error.name].message\n    ]);\n    renderAlert(title, message);\n};\n\nconst renderAlert = (title, message) => {\n    return Templates.render(TEMPLATES.DISMISSABLE_ALERT, {\n        title: title,\n        message: message\n    })\n    .then((html, js) => Templates.prependNodeContents(SELECTORS.RECORDER, html, js))\n    .catch(Notification.exception);\n};\n\nconst updateDeviceOptions = async () => {\n    const devices = await navigator.mediaDevices.enumerateDevices();\n\n    const audioDevices = devices.filter(device => device.kind === 'audioinput');\n    audioDevices[0].selected = true;\n\n    const videoDevices = devices.filter(device => device.kind === 'videoinput');\n    videoDevices[0].selected = true;\n\n    Templates.render(TEMPLATES.DEVICE_OPTIONS, {devices: audioDevices})\n        .then((html, js) => Templates.replaceNodeContents(SELECTORS.AUDIO_OPTIONS, html, js))\n        .catch(Notification.exception);\n\n    Templates.render(TEMPLATES.DEVICE_OPTIONS, {devices: videoDevices})\n        .then((html, js) => Templates.replaceNodeContents(SELECTORS.VIDEO_OPTIONS, html, js))\n        .catch(Notification.exception);\n};\n\nconst upload = async () => {\n    let uploadCredentials, progressModal;\n\n    try {\n        const formData = getFormData();\n        [uploadCredentials, progressModal] = await Promise.all([\n            KalturaAjax.getUploadCredentials(),\n            ModalFactory.create({type: ModalKalturaProgress.getType()})\n        ]);\n        progressModal.show();\n        const xml = await KalturaUploader.upload(formData, uploadCredentials, progressModal.progressCallback);\n        const newEntryId = $(xml).find('entryId').text();\n        publish(KalturaEvents.uploadComplete, newEntryId);\n    } catch (error) {\n        Notification.exception(error);\n    } finally {\n        progressModal.hide();\n        progressModal.destroy();\n    }\n};\n\nconst getFormData = () => {\n    return {\n        file: file,\n        name: root.find(SELECTORS.NAME).val().trim(),\n        tags: root.find(SELECTORS.TAGS).val().trim(),\n        desc: root.find(SELECTORS.DESC).val().trim(),\n        studentContent: root.find(SELECTORS.STUDENT_CONTENT + ':checked').val(),\n        term: root.find(SELECTORS.STUDENT_CONTENT + ':checked').val() === 'Yes' ? '' : root.find(SELECTORS.TERM).val(),\n        assessment: 'No'\n    };\n};"],"file":"upload_form_record.min.js"}