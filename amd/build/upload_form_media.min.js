define ("local_kaltura/upload_form_media",["exports","jquery","core/str","core/pubsub","core/notification","local_kaltura/kaltura_ajax","local_kaltura/kaltura_uploader","local_kaltura/kaltura_events","core/modal_factory","local_kaltura/modal_kaltura_progress"],function(a,b,c,d,e,f,g,h,i,j){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;b=k(b);e=k(e);f=k(f);g=k(g);h=k(h);i=k(i);j=k(j);function k(a){return a&&a.__esModule?a:{default:a}}function l(a,b){return o(a)||n(a,b)||m()}function m(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function n(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=!0){c.push(h.value);if(b&&c.length===b)break}}catch(a){e=!0;f=a}finally{try{if(!d&&null!=g["return"])g["return"]()}finally{if(e)throw f}}return c}function o(a){if(Array.isArray(a))return a}function p(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){c(a);return}if(h.done){b(i)}else{Promise.resolve(i).then(d,e)}}function q(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){var h=a.apply(b,c);function f(a){p(h,d,e,f,g,"next",a)}function g(a){p(h,d,e,f,g,"throw",a)}f(void 0)})}}var r=["video/3gpp","video/avi","video/dvd","video/mp4","video/mpeg","video/mts","video/ogg","video/quicktime","video/vnd.rn-realvideo","video/VP8","video/webm","video/x-msvideo","video/x-flv","video/x-f4v","video/x-ms-asf","video/x-ms-wmv","video/x-matroska"],s={HIDDEN:"hidden",HOVER:"highlighted",ERROR:"file-error"},t={NAME:"#entry_name",TAGS:"#entry_tags",DESC:"#entry_desc",FILE_PICKER:"#entry_file",STUDENT_CONTENT:"[name=\"student\"]",TERM:"#entry_term",FILE_DROP_AREA:"[data-region=\"file-drop-area\"]",FILE_INFO:"[data-region=\"file-info\"]",FILE_ERROR:"[data-region=\"file-error\"]",UPLOAD_PART_2:"[data-region=\"upload-part-2\"]"},u,v,w=function(a){u=(0,b.default)(a);x()};a.init=w;var x=function(){u.find(t.FILE_DROP_AREA).on("dragenter dragover dragleave drop",function(a){a.preventDefault();a.stopPropagation()});u.find(t.FILE_DROP_AREA).on("dragenter dragover",function(a){(0,b.default)(a.currentTarget).addClass(s.HOVER)});u.find(t.FILE_DROP_AREA).on("dragleave drop",function(a){(0,b.default)(a.currentTarget).removeClass(s.HOVER)});u.find(t.FILE_DROP_AREA).on("drop",function(a){var b=a.originalEvent.dataTransfer.files[0];y(b)});u.find(t.FILE_PICKER).on("change",function(a){var b=a.currentTarget.files[0];y(b)});u.on("submit",function(a){a.preventDefault();if(z(v)){D()}});u.on("reset",function(){v=null;C(null);B(null);u.find(t.UPLOAD_PART_2).addClass(s.HIDDEN);u.find(t.TERM).prop("disabled",!1)});u.on("change",t.STUDENT_CONTENT,function(a){u.find(t.TERM).prop("disabled","Yes"===(0,b.default)(a.currentTarget).val())})},y=function(a){C(a);if(z(a)){v=a;u.find(t.NAME).val(a.name);u.find(t.UPLOAD_PART_2).removeClass(s.HIDDEN)}},z=function(a){var b=A(a);B(b);if(b)return!1;else return!0},A=function(a){if(!a){return{key:"video_required",component:"local_kaltura"}}else if(-1===r.indexOf(a.type)){return{key:"video_valid_type",component:"local_kaltura"}}else if(a.size>2e9){return{key:"video_too_large",component:"local_kaltura"}}else if(0>=a.size){return{key:"video_no_size",component:"local_kaltura"}}else{return null}},B=function(){var a=q(regeneratorRuntime.mark(function a(b){var d;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:if(!b){a.next=6;break}a.next=3;return(0,c.get_string)(b.key,b.component);case 3:a.t0=a.sent;a.next=7;break;case 6:a.t0="";case 7:d=a.t0;u.find(t.FILE_ERROR).text(d);u.find(t.FILE_DROP_AREA).toggleClass(s.ERROR,b?!0:!1);case 10:case"end":return a.stop();}}},a)}));return function(){return a.apply(this,arguments)}}(),C=function(){var a=q(regeneratorRuntime.mark(function a(b){var d;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:d=b?(0,c.get_string)("file_selected","local_kaltura",b.name):(0,c.get_string)("no_file_selected","local_kaltura");a.t0=u.find(t.FILE_INFO);a.next=4;return d;case 4:a.t1=a.sent;a.t0.text.call(a.t0,a.t1);case 6:case"end":return a.stop();}}},a)}));return function(){return a.apply(this,arguments)}}(),D=function(){var a=q(regeneratorRuntime.mark(function a(){var c,k,m,n,o,p,q;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:a.prev=0;m=E();a.next=4;return Promise.all([f.default.getUploadCredentials(),i.default.create({type:j.default.getType()})]);case 4:n=a.sent;o=l(n,2);c=o[0];k=o[1];k.show();a.next=11;return g.default.upload(m,c,k.progressCallback);case 11:p=a.sent;q=(0,b.default)(p).find("entryId").text();(0,d.publish)(h.default.uploadComplete,q);a.next=19;break;case 16:a.prev=16;a.t0=a["catch"](0);e.default.exception(a.t0);case 19:a.prev=19;k.hide();k.destroy();return a.finish(19);case 23:case"end":return a.stop();}}},a,null,[[0,16,19,23]])}));return function(){return a.apply(this,arguments)}}(),E=function(){return{file:v,name:u.find(t.NAME).val().trim(),tags:u.find(t.TERM).val().trim(),desc:u.find(t.DESC).val().trim(),studentContent:u.find(t.STUDENT_CONTENT).val(),term:u.find(t.TERM).val(),assessment:"No"}}});
//# sourceMappingURL=upload_form_media.min.js.map
