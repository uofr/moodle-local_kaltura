{"version":3,"sources":["../src/kaltura_uploader.js"],"names":["define","$","createUploadToken","uploadData","kalturaData","fileSize","parseInt","encodeURI","file","size","serviceURL","serverhost","ks","name","ajax","type","cache","async","contentType","scriptCharset","dataType","createMediaEntry","data","FormData","append","tags","desc","creatorid","processData","uploadMediaFile","uploadTokenId","progressCallback","fd","xhr","XHR","ajaxSettings","upload","addEventListener","attachUploadedFile","entryId","addToCategory","categoryid","attachCustomMetadata","metadataid","term","studentContent","assessment","then","xml","error","find","length","Error","text"],"mappings":"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","sourcesContent":["define(['jquery'], function($) {\n\n    var upload = function(uploadData, kalturaData, progressCallback) {\n        var uploadTokenId;\n        var entryId;\n        return createUploadToken(uploadData, kalturaData)\n        .then(function(xml) {\n            const error = $(xml).find('error');\n            if (error.length) {\n                throw new Error($(xml).find('error').find('message').text());\n            }\n            uploadTokenId = $(xml).find('id').text();\n            return createMediaEntry(uploadData, kalturaData);\n        })\n        .then(function(xml) {\n            const error = $(xml).find('error');\n            if (error.length) {\n                throw new Error($(xml).find('error').find('message').text());\n            }\n            entryId = $(xml).find('id').text();\n            return uploadMediaFile(uploadData, kalturaData, uploadTokenId, progressCallback);\n        })\n        .then(function(xml) {\n            const error = $(xml).find('error');\n            if (error.length) {\n                throw new Error($(xml).find('error').find('message').text());\n            }\n            return attachUploadedFile(kalturaData, entryId, uploadTokenId);\n        })\n        .then(function(xml) {\n            const error = $(xml).find('error');\n            if (error.length) {\n                throw new Error($(xml).find('error').find('message').text());\n            }\n            return attachCustomMetadata(kalturaData, uploadData, entryId);\n        })\n        .then(function(xml) {\n            const error = $(xml).find('error');\n            if (error.length) {\n                throw new Error($(xml).find('error').find('message').text());\n            }\n            return addToCategory(kalturaData, entryId);\n        });\n    };\n\n    var createUploadToken = function(uploadData, kalturaData) {\n        var fileSize = parseInt(encodeURI(uploadData.file.size));\n        var postData = {\n            type: \"GET\",\n            cache: false,\n            async: true,\n            contentType: false,\n            scriptCharset: \"utf-8\",\n            dataType: \"xml\"\n        };\n        var serviceURL = kalturaData.serverhost + \"/api_v3/service/uploadToken/action/add?ks=\" + kalturaData.ks;\n        serviceURL += \"&uploadToken:objectType=KalturaUploadToken\";\n        serviceURL += \"uploadToken:fileName=\" + encodeURI(uploadData.file.name);\n        serviceURL += \"&uploadToken:fileSize=\" + fileSize;\n        serviceURL += \"&uploadToken:autoFinalize=-1\";\n\n        return $.ajax(serviceURL, postData);\n    };\n\n    var createMediaEntry = function(uploadData, kalturaData) {\n        var data = new FormData();\n        data.append(\"action\", \"add\");\n        data.append(\"ks\", kalturaData.ks);\n        data.append(\"entry:objectType\", \"KalturaMediaEntry\");\n        data.append(\"entry:mediaType\", 1);\n        data.append(\"entry:sourceType\", 1);\n        data.append(\"entry:name\", uploadData.name);\n        data.append(\"entry:tags\", uploadData.tags);\n        data.append(\"entry:description\", uploadData.desc);\n        data.append(\"entry:creatorId\", kalturaData.creatorid);\n        data.append(\"entry:userId\", kalturaData.creatorid);\n\n        var postData = {\n            type: \"POST\",\n            data: data,\n            cache: false,\n            async: true,\n            contentType: false,\n            scriptCharset: \"utf-8\",\n            processData: false,\n            dataType: \"xml\"\n        };\n        var serviceURL = kalturaData.serverhost + \"/api_v3/service/media/action/add\";\n        return $.ajax(serviceURL, postData);\n    };\n\n    var uploadMediaFile = function(uploadData, kalturaData, uploadTokenId, progressCallback) {\n        var fd = new FormData();\n        fd.append(\"action\", \"upload\");\n        fd.append(\"ks\", kalturaData.ks);\n        fd.append(\"uploadTokenId\", uploadTokenId);\n        fd.append(\"fileData\", uploadData.file, encodeURI(uploadData.file.name), uploadData.file.size);\n        fd.append(\"resume\", false);\n        fd.append(\"finalChunk\", true);\n        fd.append(\"resumeAt\", 0);\n\n        var postData = {\n            type: \"POST\",\n            data: fd,\n            cache: false,\n            async: true,\n            contentType: false,\n            scriptCharset: \"utf-8\",\n            processData: false,\n            dataType: \"xml\",\n            xhr: function() {\n                var XHR = $.ajaxSettings.xhr();\n                if (XHR.upload) {\n                    XHR.upload.addEventListener(\"progress\", progressCallback, false);\n                }\n                return XHR;\n            }\n        };\n        var serviceURL = kalturaData.serverhost + \"/api_v3/service/uploadToken/action/upload\";\n        return $.ajax(serviceURL, postData);\n    };\n\n    var attachUploadedFile = function(kalturaData, entryId, uploadTokenId) {\n        var fd = new FormData();\n        fd.append(\"action\", \"addContent\");\n        fd.append(\"ks\", kalturaData.ks);\n        fd.append(\"entryId\", entryId);\n        fd.append(\"resource:objectType\", \"KalturaUploadedFileTokenResource\");\n        fd.append(\"resource:token\", uploadTokenId);\n\n        var postData = {\n            type: \"POST\",\n            data: fd,\n            cache: false,\n            async: true,\n            contentType: false,\n            scriptCharset: \"utf-8\",\n            processData: false,\n            dataType: \"xml\"\n        };\n        var serviceURL = kalturaData.serverhost + \"/api_v3/service/media/action/addContent\";\n        return $.ajax(serviceURL, postData);\n    };\n\n    var addToCategory = function(kalturaData, entryId) {\n        var fd = new FormData();\n        fd.append('ks', kalturaData.ks);\n        fd.append(\"categoryEntry:objectType\", \"KalturaCategoryEntry\");\n        fd.append('categoryEntry:categoryId', kalturaData.categoryid);\n        fd.append('categoryEntry:entryId', entryId);\n\n        var postData = {\n            type: \"POST\",\n            data: fd,\n            cache: false,\n            async: true,\n            contentType: false,\n            scriptCharset: \"utf-8\",\n            processData: false,\n            dataType: \"xml\"\n        };\n        var serviceURL = kalturaData.serverhost + \"/api_v3/service/categoryentry/action/add\";\n        return $.ajax(serviceURL, postData);\n    };\n\n    var attachCustomMetadata = function(kalturaData, uploadData, entryId) {\n        var fd = new FormData();\n        fd.append(\"action\", \"add\");\n        fd.append(\"ks\", kalturaData.ks);\n        fd.append(\"metadataProfileId\", kalturaData.metadataid);\n        fd.append(\"objectType\", '1');\n        fd.append(\"objectId\", entryId);\n        fd.append(\"xmlData\", `<metadata>\n            <StoreMedia>${uploadData.term}</StoreMedia>\n            <StudentContent>${uploadData.studentContent}</StudentContent>\n            <Assessment>${uploadData.assessment}</Assessment>\n            </metadata>`);\n        var postData = {\n            type: \"POST\",\n            data: fd,\n            cache: false,\n            async: true,\n            contentType: false,\n            scriptCharset: \"utf-8\",\n            processData: false,\n            dataType: \"xml\"\n        };\n        var serviceURL = kalturaData.serverhost + \"/api_v3/service/metadata_metadata/action/add\";\n        return  $.ajax(serviceURL, postData);\n    };\n\n    return {\n        upload: upload\n    };\n\n});\n"],"file":"kaltura_uploader.min.js"}