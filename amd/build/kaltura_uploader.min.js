define ("local_kaltura/kaltura_uploader",["jquery"],function(a){var b=function(b,c){var d=parseInt(encodeURI(b.file.size)),e=c.serverhost+"/api_v3/service/uploadToken/action/add?ks="+c.ks;e+="&uploadToken:objectType=KalturaUploadToken";e+="uploadToken:fileName="+encodeURI(b.file.name);e+="&uploadToken:fileSize="+d;e+="&uploadToken:autoFinalize=-1";return a.ajax(e,{type:"GET",cache:!1,async:!0,contentType:!1,scriptCharset:"utf-8",dataType:"xml"})},c=function(b,c){var d=new FormData;d.append("action","add");d.append("ks",c.ks);d.append("entry:objectType","KalturaMediaEntry");d.append("entry:mediaType",1);d.append("entry:sourceType",1);d.append("entry:name",b.name);d.append("entry:tags",b.tags);d.append("entry:description",b.desc);d.append("entry:creatorId",c.creatorid);d.append("entry:userId",c.creatorid);var e=c.serverhost+"/api_v3/service/media/action/add";return a.ajax(e,{type:"POST",data:d,cache:!1,async:!0,contentType:!1,scriptCharset:"utf-8",processData:!1,dataType:"xml"})},d=function(b,c,d,e){var f=new FormData;f.append("action","upload");f.append("ks",c.ks);f.append("uploadTokenId",d);f.append("fileData",b.file,encodeURI(b.file.name),b.file.size);f.append("resume",!1);f.append("finalChunk",!0);f.append("resumeAt",0);var g=c.serverhost+"/api_v3/service/uploadToken/action/upload";return a.ajax(g,{type:"POST",data:f,cache:!1,async:!0,contentType:!1,scriptCharset:"utf-8",processData:!1,dataType:"xml",xhr:function xhr(){var b=a.ajaxSettings.xhr();if(b.upload){b.upload.addEventListener("progress",e,!1)}return b}})},e=function(b,c,d){var e=new FormData;e.append("action","addContent");e.append("ks",b.ks);e.append("entryId",c);e.append("resource:objectType","KalturaUploadedFileTokenResource");e.append("resource:token",d);var f=b.serverhost+"/api_v3/service/media/action/addContent";return a.ajax(f,{type:"POST",data:e,cache:!1,async:!0,contentType:!1,scriptCharset:"utf-8",processData:!1,dataType:"xml"})},f=function(b,c){var d=new FormData;d.append("ks",b.ks);d.append("categoryEntry:objectType","KalturaCategoryEntry");d.append("categoryEntry:categoryId",b.categoryid);d.append("categoryEntry:entryId",c);var e=b.serverhost+"/api_v3/service/categoryentry/action/add";return a.ajax(e,{type:"POST",data:d,cache:!1,async:!0,contentType:!1,scriptCharset:"utf-8",processData:!1,dataType:"xml"})},g=function(b,c,d){var e=new FormData;e.append("action","add");e.append("ks",b.ks);e.append("metadataProfileId",b.metadataid);e.append("objectType","1");e.append("objectId",d);e.append("xmlData","<metadata>\n            <StoreMedia>".concat(c.term,"</StoreMedia>\n            <StudentContent>").concat(c.studentContent,"</StudentContent>\n            <Assessment>").concat(c.assessment,"</Assessment>\n            </metadata>"));var f=b.serverhost+"/api_v3/service/metadata_metadata/action/add";return a.ajax(f,{type:"POST",data:e,cache:!1,async:!0,contentType:!1,scriptCharset:"utf-8",processData:!1,dataType:"xml"})};return{upload:function upload(h,i,j){var k,l;return b(h,i).then(function(b){var d=a(b).find("error");if(d.length){throw new Error(a(b).find("error").find("message").text())}k=a(b).find("id").text();return c(h,i)}).then(function(b){var c=a(b).find("error");if(c.length){throw new Error(a(b).find("error").find("message").text())}l=a(b).find("id").text();return d(h,i,k,j)}).then(function(b){var c=a(b).find("error");if(c.length){throw new Error(a(b).find("error").find("message").text())}return e(i,l,k)}).then(function(b){var c=a(b).find("error");if(c.length){throw new Error(a(b).find("error").find("message").text())}return g(i,h,l)}).then(function(b){var c=a(b).find("error");if(c.length){throw new Error(a(b).find("error").find("message").text())}return f(i,l)})}}});
//# sourceMappingURL=kaltura_uploader.min.js.map
