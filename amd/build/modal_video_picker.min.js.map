{"version":3,"sources":["../src/modal_video_picker.js"],"names":["SELECTORS","VIDEO_PICKER_MAIN","ENTRY_LIST","ENTRY","PAGING_BAR","PAGE_ITEM","PAGE_LINK","NEXT_PAGE","PREV_PAGE","SEARCH_FORM","SEARCH_INPUT","SEARCH_CLEAR","SORT","ENTRY_CHECKBOX","CONFIRM","ENTRY_ID","ENTRY_NAME","ENTRY_THUMB","ENTRY_SELECTED_HDR","VIDEO_TITLE","TEMPLATES","OVERLAY_LOADING","ModalVideoPicker","root","contextid","search","sort","page","source","selectedEntryId","selectedEntryName","selectedEntryThumb","getRoot","on","ModalEvents","shown","refreshModal","hidden","html","reset","setSelectedEntry","e","setPage","currentTarget","attr","lastPage","last","preventDefault","val","not","prop","entry","closest","entryId","entryName","find","text","entryThumb","hide","pageIndex","removeClass","pageLinks","filter","each","index","element","parent","addClass","promises","Ajax","call","KalturaAjax","getVideoPickerData","then","response","replace","catch","Notification","exception","loadUntilPromisesDone","areaSelector","Templates","render","loadingIcon","append","fadeIn","$","when","promise","Promise","all","fadeOut","remove","entryid","entryname","entrythumb","string","data","template","js","replaceNodeContents","Modal","registered","ModalRegistry","register","getType"],"mappings":"6TAAA,OACA,OACA,OACA,OAGA,OACA,OACA,OAEA,O,44DAEMA,CAAAA,CAAS,CAAG,CACdC,iBAAiB,CAAE,qCADL,CAEdC,UAAU,CAAE,8BAFE,CAGdC,KAAK,CAAE,cAHO,CAIdC,UAAU,CAAE,8BAJE,CAKdC,SAAS,CAAE,YALG,CAMdC,SAAS,CAAE,4DANG,CAOdC,SAAS,CAAE,6BAPG,CAQdC,SAAS,CAAE,6BARG,CASdC,WAAW,CAAE,kCATC,CAUdC,YAAY,CAAE,qBAVA,CAWdC,YAAY,CAAE,wCAXA,CAYdC,IAAI,CAAE,eAZQ,CAadC,cAAc,CAAE,yBAbF,CAcdC,OAAO,CAAE,2CAdK,CAedC,QAAQ,CAAE,WAfI,CAgBdC,UAAU,CAAE,UAhBE,CAiBdC,WAAW,CAAE,kBAjBC,CAkBdC,kBAAkB,CAAE,yCAlBN,CAmBdC,WAAW,CAAE,cAnBC,C,CAsBZC,CAAS,CAAG,CACdC,eAAe,CAAE,sBADH,CAEdpB,iBAAiB,CAAE,uCAFL,C,CAKGqB,C,oBAEjB,WAAYC,CAAZ,CAAkB,iBACd,wBAAMA,CAAN,GACA,EAAKC,SAAL,CAAiB,IAAjB,CACA,EAAKC,MAAL,CAAc,EAAd,CACA,EAAKC,IAAL,CAAY,QAAZ,CACA,EAAKC,IAAL,CAAY,CAAZ,CACA,EAAKC,MAAL,CAAc,CAAd,CACA,EAAKC,eAAL,CAAuB,IAAvB,CACA,EAAKC,iBAAL,CAAyB,IAAzB,CACA,EAAKC,kBAAL,CAA0B,IAA1B,CATc,QAUjB,C,0EAEwB,YACrB,2DAEA,KAAKC,OAAL,GAAeC,EAAf,CAAkBC,UAAYC,KAA9B,CAAqC,UAAM,CACvC,CAAI,CAACC,YAAL,EACH,CAFD,EAIA,KAAKJ,OAAL,GAAeC,EAAf,CAAkBC,UAAYG,MAA9B,CAAsC,UAAM,CACxC,cAAErC,CAAS,CAACC,iBAAZ,EAA+BqC,IAA/B,CAAoC,EAApC,EACA,CAAI,CAACC,KAAL,GACA,GAAI,CAAI,CAACV,eAAL,EAAwB,CAAI,CAACC,iBAA7B,EAAkD,CAAI,CAACC,kBAA3D,CAA+E,CAC3E,CAAI,CAACS,gBAAL,CAAsB,CAAI,CAACX,eAA3B,CAA4C,CAAI,CAACC,iBAAjD,CAAoE,CAAI,CAACC,kBAAzE,CACH,CACJ,CAND,EAQA,KAAKC,OAAL,GAAeC,EAAf,CAAkB,OAAlB,CAA2BjC,CAAS,CAACM,SAArC,CAAgD,SAACmC,CAAD,CAAO,CACnD,CAAI,CAACC,OAAL,CAAa,cAAED,CAAC,CAACE,aAAJ,EAAmBC,IAAnB,CAAwB,iBAAxB,CAAb,EACA,CAAI,CAACR,YAAL,EACH,CAHD,EAKA,KAAKJ,OAAL,GAAeC,EAAf,CAAkB,OAAlB,CAA2BjC,CAAS,CAACO,SAArC,CAAgD,UAAM,CAClD,GAAMsC,CAAAA,CAAQ,CAAG,cAAE7C,CAAS,CAACM,SAAZ,EAAuBwC,IAAvB,GAA8BF,IAA9B,CAAmC,iBAAnC,CAAjB,CACA,GAAI,CAAI,CAACjB,IAAL,EAAakB,CAAjB,CAA2B,OAC3B,CAAI,CAACH,OAAL,CAAa,EAAE,CAAI,CAACf,IAApB,EACA,CAAI,CAACS,YAAL,EACH,CALD,EAOA,KAAKJ,OAAL,GAAeC,EAAf,CAAkB,OAAlB,CAA2BjC,CAAS,CAACQ,SAArC,CAAgD,UAAM,CAClD,GAAiB,CAAb,EAAA,CAAI,CAACmB,IAAT,CAAoB,OACpB,CAAI,CAACe,OAAL,CAAa,EAAE,CAAI,CAACf,IAApB,EACA,CAAI,CAACS,YAAL,EACH,CAJD,EAMA,KAAKJ,OAAL,GAAeC,EAAf,CAAkB,QAAlB,CAA4BjC,CAAS,CAACS,WAAtC,CAAmD,SAACgC,CAAD,CAAO,CACtDA,CAAC,CAACM,cAAF,GACA,CAAI,CAACtB,MAAL,CAAc,cAAEzB,CAAS,CAACU,YAAZ,EAA0BsC,GAA1B,EAAd,CACA,CAAI,CAACN,OAAL,CAAa,CAAb,EACA,CAAI,CAACN,YAAL,EACH,CALD,EAOA,KAAKJ,OAAL,GAAeC,EAAf,CAAkB,OAAlB,CAA2BjC,CAAS,CAACW,YAArC,CAAmD,UAAM,CACrD,CAAI,CAACc,MAAL,CAAc,EAAd,CACA,cAAEzB,CAAS,CAACU,YAAZ,EAA0BsC,GAA1B,CAA8B,EAA9B,EACA,CAAI,CAACN,OAAL,CAAa,CAAb,EACA,CAAI,CAACN,YAAL,EACH,CALD,EAOA,KAAKJ,OAAL,GAAeC,EAAf,CAAkB,QAAlB,CAA4BjC,CAAS,CAACY,IAAtC,CAA4C,SAAC6B,CAAD,CAAO,CAC/CA,CAAC,CAACM,cAAF,GACA,CAAI,CAACL,OAAL,CAAa,CAAb,EACA,CAAI,CAAChB,IAAL,CAAY,cAAEe,CAAC,CAACE,aAAJ,EAAmBK,GAAnB,EAAZ,CACA,CAAI,CAACZ,YAAL,EACH,CALD,EAOA,KAAKJ,OAAL,GAAeC,EAAf,CAAkB,QAAlB,CAA4BjC,CAAS,CAACa,cAAtC,CAAsD,SAAC4B,CAAD,CAAO,CACzD,cAAEzC,CAAS,CAACa,cAAZ,EAA4BoC,GAA5B,CAAgC,cAAER,CAAC,CAACE,aAAJ,CAAhC,EAAoDO,IAApD,CAAyD,SAAzD,KACA,cAAElD,CAAS,CAACc,OAAZ,EAAqBoC,IAArB,CAA0B,UAA1B,CAAsC,CAAC,cAAET,CAAC,CAACE,aAAJ,EAAmBO,IAAnB,CAAwB,SAAxB,CAAvC,EAEA,GAAI,cAAET,CAAC,CAACE,aAAJ,EAAmBO,IAAnB,CAAwB,SAAxB,CAAJ,CAAwC,IAC9BC,CAAAA,CAAK,CAAG,cAAEV,CAAC,CAACE,aAAJ,EAAmBS,OAAnB,CAA2BpD,CAAS,CAACG,KAArC,CADsB,CAE9BkD,CAAO,CAAGF,CAAK,CAACP,IAAN,CAAW,YAAX,CAFoB,CAG9BU,CAAS,CAAGH,CAAK,CAACI,IAAN,CAAW,aAAX,EAA0BC,IAA1B,EAHkB,CAI9BC,CAAU,CAAGN,CAAK,CAACI,IAAN,CAAW,KAAX,EAAkBX,IAAlB,CAAuB,KAAvB,CAJiB,CAKpC,CAAI,CAACf,eAAL,CAAuBwB,CAAvB,CACA,CAAI,CAACvB,iBAAL,CAAyBwB,CAAzB,CACA,CAAI,CAACvB,kBAAL,CAA0B0B,CAC7B,CARD,IAQO,CACH,CAAI,CAAC5B,eAAL,CAAuB,IAAvB,CACA,CAAI,CAACC,iBAAL,CAAyB,IAAzB,CACA,CAAI,CAACC,kBAAL,CAA0B,IAC7B,CACJ,CAjBD,EAmBA,KAAKC,OAAL,GAAeC,EAAf,CAAkB,OAAlB,CAA2BjC,CAAS,CAACc,OAArC,CAA8C,UAAM,CAChD,CAAI,CAAC0B,gBAAL,CAAsB,CAAI,CAACX,eAA3B,CAA4C,CAAI,CAACC,iBAAjD,CAAoE,CAAI,CAACC,kBAAzE,EACA,CAAI,CAAC2B,IAAL,EACH,CAHD,CAIH,C,wCAEOC,C,CAAW,CACf,KAAKhC,IAAL,CAAYgC,CAAZ,CACA,cAAE3D,CAAS,CAACK,SAAZ,EAAuBuD,WAAvB,CAAmC,QAAnC,EACA,GAAMC,CAAAA,CAAS,CAAG,cAAE7D,CAAS,CAACM,SAAZ,EAAuBwD,MAAvB,8BAAmDH,CAAnD,QAAlB,CACAE,CAAS,CAACE,IAAV,CAAe,SAACC,CAAD,CAAQC,CAAR,CAAoB,CAC/B,cAAEA,CAAF,EAAWC,MAAX,GAAoBC,QAApB,CAA6B,QAA7B,CACH,CAFD,CAGH,C,kLAGSC,C,CAAWC,UAAKC,IAAL,CAAU,CACvBC,UAAYC,kBAAZ,CAA+B,KAAKhD,SAApC,CAA+C,KAAKC,MAApD,CAA4D,KAAKC,IAAjE,CAAuE,KAAKC,IAA5E,CAAkF,KAAKC,MAAvF,CADuB,CAAV,C,CAGjBwC,CAAQ,CAAC,CAAD,CAAR,CACKK,IADL,CACU,SAAAC,CAAQ,QAAI,CAAA,CAAI,CAACC,OAAL,CAAaD,CAAb,CAAuBtD,CAAS,CAACnB,iBAAjC,CAAoDD,CAAS,CAACC,iBAA9D,CAAJ,CADlB,EAEKwE,IAFL,CAEU,iBAAM,sCAAkB,CAAI,CAAC5C,eAAvB,SAA4C0B,IAA5C,CAAiDvD,CAAS,CAACa,cAA3D,EAA2EqC,IAA3E,CAAgF,SAAhF,IAAN,CAFV,EAGK0B,KAHL,CAGWC,UAAaC,SAHxB,EAIA,KAAKC,qBAAL,CAA2B/E,CAAS,CAACC,iBAArC,CAAwDmE,CAAxD,EACKQ,KADL,CACWC,UAAaC,SADxB,E,qLAIkBE,C,CAAcZ,C,CAAU,CAC1C,MAAOa,WAAUC,MAAV,CAAiB9D,CAAS,CAACC,eAA3B,CAA4C,EAA5C,EACFoD,IADE,CACG,SAACnC,CAAD,CAAU,CACZ,GAAM6C,CAAAA,CAAW,CAAG,cAAE7C,CAAF,CAApB,CACA,cAAE0C,CAAF,EAAgBI,MAAhB,CAAuBD,CAAvB,EACAA,CAAW,CAACE,MAAZ,CAAmB,GAAnB,EAEA,MAAOC,WAAEC,IAAF,CAAOJ,CAAW,CAACK,OAAZ,EAAP,CAA8BC,OAAO,CAACC,GAAR,CAAYtB,CAAZ,CAA9B,CACV,CAPE,EAQFK,IARE,CAQG,SAACU,CAAD,CAAiB,CACnBA,CAAW,CAACQ,OAAZ,CAAoB,GAApB,EACAR,CAAW,CAACS,MAAZ,EAGH,CAbE,CAcV,C,0DAEgBC,C,CAASC,C,CAAWC,C,CAAY,CAC7C,cAAE/F,CAAS,CAACe,QAAZ,EAAsBiC,GAAtB,CAA0B6C,CAA1B,EACA,cAAE7F,CAAS,CAACgB,UAAZ,EAAwBgC,GAAxB,CAA4B8C,CAA5B,EACA,cAAE9F,CAAS,CAACiB,WAAZ,EAAyB2B,IAAzB,CAA8B,KAA9B,CAAqCmD,CAArC,EACA,cAAE/F,CAAS,CAACmB,WAAZ,EAAyB6B,GAAzB,CAA6B8C,CAA7B,EACA,iBAAU,gBAAV,CAA4B,eAA5B,CAA6CA,CAA7C,EACCrB,IADD,CACM,SAAAuB,CAAM,QAAI,cAAEhG,CAAS,CAACkB,kBAAZ,EAAgCsC,IAAhC,CAAqCwC,CAArC,CAAJ,CADZ,CAEH,C,wCAEOC,C,CAAMC,C,CAAUlB,C,CAAc,CAClC,MAAOC,WAAUC,MAAV,CAAiBgB,CAAjB,CAA2BD,CAA3B,EACNxB,IADM,CACD,SAACnC,CAAD,CAAO6D,CAAP,QAAclB,WAAUmB,mBAAV,CAA8BpB,CAA9B,CAA4C1C,CAA5C,CAAkD6D,CAAlD,CAAd,CADC,CAEV,C,qCAEO,CACJ,KAAK1E,MAAL,CAAc,EAAd,CACA,cAAEzB,CAAS,CAACU,YAAZ,EAA0BsC,GAA1B,CAA8B,EAA9B,EACA,KAAKtB,IAAL,CAAY,QAAZ,CACA,cAAE1B,CAAS,CAACY,IAAZ,EAAkBsC,IAAlB,CAAuB,eAAvB,CAAwC,CAAxC,EACA,KAAKR,OAAL,CAAa,CAAb,EACA,KAAKd,MAAL,CAAc,CACjB,C,2CAEgB,CACb,MAAO,kCACV,C,cA5JyCyE,S,cA+J9C,GAAIC,CAAAA,CAAU,GAAd,CACA,GAAI,CAACA,CAAL,CAAiB,CACbC,UAAcC,QAAd,CAAuBlF,CAAgB,CAACmF,OAAjB,EAAvB,CAAmDnF,CAAnD,CAAqE,kCAArE,EACAgF,CAAU,GACb,C","sourcesContent":["import $ from 'jquery';\nimport Ajax from 'core/ajax';\nimport Notification from 'core/notification';\nimport Templates from 'core/templates';\nimport {get_string as getString} from 'core/str';\n\nimport Modal from 'core/modal';\nimport ModalRegistry from 'core/modal_registry';\nimport ModalEvents from 'core/modal_events';\n\nimport KalturaAjax from 'local_kaltura/kaltura_ajax';\n\nconst SELECTORS = {\n    VIDEO_PICKER_MAIN: '[data-region=\"video-picker-main\"]',\n    ENTRY_LIST: '[data-region=\"entry-list\"]',\n    ENTRY: '[data-entry]',\n    PAGING_BAR: '[data-region=\"paging-bar\"]',\n    PAGE_ITEM: '.page-item',\n    PAGE_LINK: '[data-region=\"paging-bar\"] [data-action=\"switch-page\"]',\n    NEXT_PAGE: '[data-action=\"next-page\"]',\n    PREV_PAGE: '[data-action=\"prev-page\"]',\n    SEARCH_FORM: '[data-action=\"kaltura-search\"]',\n    SEARCH_INPUT: '#kaltura_search_box',\n    SEARCH_CLEAR: '[data-action=\"kaltura-clear-search\"]',\n    SORT: '#kaltura_sort',\n    ENTRY_CHECKBOX: '.kaltura-entry-checkbox',\n    CONFIRM: '[data-action=\"confirm-entry-selection\"]',\n    ENTRY_ID: '#entry_id',\n    ENTRY_NAME: '#id_name',\n    ENTRY_THUMB: '#media_thumbnail',\n    ENTRY_SELECTED_HDR: '[data-region=\"selected-entry-header\"]',\n    VIDEO_TITLE: '#video_title'\n};\n\nconst TEMPLATES = {\n    OVERLAY_LOADING: 'core/overlay_loading',\n    VIDEO_PICKER_MAIN: 'local_kaltura/modal_video_picker_main'\n};\n\nexport default class ModalVideoPicker extends Modal {\n\n    constructor(root) {\n        super(root);\n        this.contextid = null;\n        this.search = '';\n        this.sort = 'recent';\n        this.page = 0;\n        this.source = 1;\n        this.selectedEntryId = null;\n        this.selectedEntryName = null;\n        this.selectedEntryThumb = null;\n    }\n\n    registerEventListeners() {\n        super.registerEventListeners();\n\n        this.getRoot().on(ModalEvents.shown, () => {\n            this.refreshModal();\n        });\n\n        this.getRoot().on(ModalEvents.hidden, () => {\n            $(SELECTORS.VIDEO_PICKER_MAIN).html('');\n            this.reset();\n            if (this.selectedEntryId && this.selectedEntryName && this.selectedEntryThumb) {\n                this.setSelectedEntry(this.selectedEntryId, this.selectedEntryName, this.selectedEntryThumb);\n            }\n        });\n\n        this.getRoot().on('click', SELECTORS.PAGE_LINK, (e) => {\n            this.setPage($(e.currentTarget).attr('data-page-index'));\n            this.refreshModal();\n        });\n\n        this.getRoot().on('click', SELECTORS.NEXT_PAGE, () => {\n            const lastPage = $(SELECTORS.PAGE_LINK).last().attr('data-page-index');\n            if (this.page == lastPage) return;\n            this.setPage(++this.page);\n            this.refreshModal();\n        });\n\n        this.getRoot().on('click', SELECTORS.PREV_PAGE, () => {\n            if (this.page == 0) return;\n            this.setPage(--this.page);\n            this.refreshModal();\n        });\n\n        this.getRoot().on('submit', SELECTORS.SEARCH_FORM, (e) => {\n            e.preventDefault();\n            this.search = $(SELECTORS.SEARCH_INPUT).val();\n            this.setPage(0);\n            this.refreshModal();\n        });\n\n        this.getRoot().on('click', SELECTORS.SEARCH_CLEAR, () => {\n            this.search = '';\n            $(SELECTORS.SEARCH_INPUT).val('');\n            this.setPage(0);\n            this.refreshModal();\n        });\n\n        this.getRoot().on('change', SELECTORS.SORT, (e) => {\n            e.preventDefault();\n            this.setPage(0);\n            this.sort = $(e.currentTarget).val();\n            this.refreshModal();\n        });\n\n        this.getRoot().on('change', SELECTORS.ENTRY_CHECKBOX, (e) => {\n            $(SELECTORS.ENTRY_CHECKBOX).not($(e.currentTarget)).prop('checked', false);\n            $(SELECTORS.CONFIRM).prop('disabled', !$(e.currentTarget).prop('checked'));\n\n            if ($(e.currentTarget).prop('checked')) {\n                const entry = $(e.currentTarget).closest(SELECTORS.ENTRY);\n                const entryId = entry.attr('data-entry');\n                const entryName = entry.find('.card-title').text();\n                const entryThumb = entry.find('img').attr('src');\n                this.selectedEntryId = entryId;\n                this.selectedEntryName = entryName;\n                this.selectedEntryThumb = entryThumb;\n            } else {\n                this.selectedEntryId = null;\n                this.selectedEntryName = null;\n                this.selectedEntryThumb = null;\n            }\n        });\n\n        this.getRoot().on('click', SELECTORS.CONFIRM, () => {\n            this.setSelectedEntry(this.selectedEntryId, this.selectedEntryName, this.selectedEntryThumb);\n            this.hide();\n        });\n    }\n\n    setPage(pageIndex) {\n        this.page = pageIndex;\n        $(SELECTORS.PAGE_ITEM).removeClass('active');\n        const pageLinks = $(SELECTORS.PAGE_LINK).filter(`[data-page-index=\"${pageIndex}\"]`);\n        pageLinks.each((index, element) => {\n            $(element).parent().addClass('active');\n        });\n    }\n\n    async refreshModal() {\n        const promises = Ajax.call([\n            KalturaAjax.getVideoPickerData(this.contextid, this.search, this.sort, this.page, this.source),\n        ]);\n        promises[0]\n            .then(response => this.replace(response, TEMPLATES.VIDEO_PICKER_MAIN, SELECTORS.VIDEO_PICKER_MAIN))\n            .then(() => $(`[data-entry=\"${this.selectedEntryId}\"]`).find(SELECTORS.ENTRY_CHECKBOX).prop('checked', true))\n            .catch(Notification.exception);\n        this.loadUntilPromisesDone(SELECTORS.VIDEO_PICKER_MAIN, promises)\n            .catch(Notification.exception);\n    }\n\n    loadUntilPromisesDone(areaSelector, promises) {\n        return Templates.render(TEMPLATES.OVERLAY_LOADING, {})\n            .then((html) => {\n                const loadingIcon = $(html);\n                $(areaSelector).append(loadingIcon);\n                loadingIcon.fadeIn(150);\n\n                return $.when(loadingIcon.promise(), Promise.all(promises));\n            })\n            .then((loadingIcon) => {\n                loadingIcon.fadeOut(100);\n                loadingIcon.remove();\n\n                return;\n            });\n    }\n\n    setSelectedEntry(entryid, entryname, entrythumb) {\n        $(SELECTORS.ENTRY_ID).val(entryid);\n        $(SELECTORS.ENTRY_NAME).val(entryname);\n        $(SELECTORS.ENTRY_THUMB).attr('src', entrythumb);\n        $(SELECTORS.VIDEO_TITLE).val(entryname);\n        getString('selected_entry', 'local_kaltura', entryname)\n        .then(string => $(SELECTORS.ENTRY_SELECTED_HDR).text(string));\n    }\n\n    replace(data, template, areaSelector) {\n        return Templates.render(template, data)\n        .then((html, js) => Templates.replaceNodeContents(areaSelector, html, js));\n    }\n\n    reset() {\n        this.search = '';\n        $(SELECTORS.SEARCH_INPUT).val('');\n        this.sort = 'recent';\n        $(SELECTORS.SORT).prop('selectedIndex', 0);\n        this.setPage(0);\n        this.source = 1;\n    }\n\n    static getType() {\n        return 'local_kaltura_modal_video_picker';\n    }\n}\n\nlet registered = false;\nif (!registered) {\n    ModalRegistry.register(ModalVideoPicker.getType(), ModalVideoPicker, 'local_kaltura/modal_video_picker');\n    registered = true;\n}\n"],"file":"modal_video_picker.min.js"}