{"version":3,"sources":["../src/modal_video_picker.js"],"names":["SELECTORS","VIDEO_PICKER_ENTRY_LIST","ENTRY_LIST","ENTRY","ENTRY_NAME","ENTRY_THUMBNAIL","PAGING_BAR","PAGE_ITEM","PAGE_LINK","NEXT_PAGE","PREV_PAGE","SEARCH_FORM","SEARCH_INPUT","SEARCH_CLEAR","SORT","ENTRY_CHECKBOX","CONFIRM","SELECTED_ENTRY_NAME","TEMPLATES","OVERLAY_LOADING","VIDEO_PICKER_BODY","ModalVideoPicker","root","contextid","search","sort","page","source","selectedEntryId","selectedEntryName","selectedEntryThumbnail","getRoot","on","ModalEvents","shown","renderBody","selectedEntryText","text","bodyRendered","find","prop","hidden","setBody","ModalVideoPickerEvents","entrySelected","entryId","entryName","entryThumbnail","hide","e","setPage","currentTarget","attr","refreshEntryList","lastPage","last","preventDefault","val","not","entry","closest","KalturaAjax","getVideoPickerData","data","renderPromise","Templates","render","promise","then","response","replace","catch","Notification","exception","loadUntilPromiseDone","pageIndex","removeClass","pageLinks","filter","each","index","element","parent","addClass","areaSelector","html","loadingIcon","append","fadeIn","$","when","fadeOut","remove","template","js","replaceNodeContents","Modal","registered","ModalRegistry","register","getType"],"mappings":"2WAAA,OACA,OACA,OAIA,OACA,OACA,OACA,OAEA,O,44DAEMA,CAAAA,CAAS,CAAG,CACdC,uBAAuB,CAAE,2CADX,CAEdC,UAAU,CAAE,8BAFE,CAGdC,KAAK,CAAE,cAHO,CAIdC,UAAU,CAAE,8BAJE,CAKdC,eAAe,CAAE,mCALH,CAMdC,UAAU,CAAE,8BANE,CAOdC,SAAS,CAAE,YAPG,CAQdC,SAAS,CAAE,4DARG,CASdC,SAAS,CAAE,6BATG,CAUdC,SAAS,CAAE,6BAVG,CAWdC,WAAW,CAAE,kCAXC,CAYdC,YAAY,CAAE,qBAZA,CAadC,YAAY,CAAE,wCAbA,CAcdC,IAAI,CAAE,eAdQ,CAedC,cAAc,CAAE,yBAfF,CAgBdC,OAAO,CAAE,2CAhBK,CAiBdC,mBAAmB,CAAE,uCAjBP,C,CAoBZC,CAAS,CAAG,CACdC,eAAe,CAAE,sBADH,CAEdC,iBAAiB,CAAE,uCAFL,CAGdnB,uBAAuB,CAAE,6CAHX,C,CAMGoB,C,oBAEjB,WAAYC,CAAZ,CAAkB,iBACd,wBAAMA,CAAN,GACA,EAAKC,SAAL,CAAiB,IAAjB,CACA,EAAKC,MAAL,CAAc,EAAd,CACA,EAAKC,IAAL,CAAY,QAAZ,CACA,EAAKC,IAAL,CAAY,CAAZ,CACA,EAAKC,MAAL,CAAc,CAAd,CACA,EAAKC,eAAL,CAAuB,IAAvB,CACA,EAAKC,iBAAL,CAAyB,IAAzB,CACA,EAAKC,sBAAL,CAA8B,IAA9B,CATc,QAUjB,C,0EAEwB,YACrB,2DAEA,KAAKC,OAAL,GAAeC,EAAf,CAAkBC,UAAYC,KAA9B,2BAAqC,oGACjC,CAAI,CAACC,UAAL,GADiC,KAE7B,CAAI,CAACP,eAAL,EAAwB,CAAI,CAACC,iBAA7B,EAAkD,CAAI,CAACC,sBAF1B,iCAGG,iBAAU,gBAAV,CAA4B,eAA5B,CAA6C,CAAI,CAACD,iBAAlD,CAHH,QAGvBO,CAHuB,QAI7B,cAAEpC,CAAS,CAACiB,mBAAZ,EAAiCoB,IAAjC,CAAsCD,CAAtC,EAJ6B,wCAArC,IAQA,KAAKL,OAAL,GAAeC,EAAf,CAAkBC,UAAYK,YAA9B,CAA4C,UAAM,CAC9C,sCAAkB,CAAI,CAACV,eAAvB,SAA4CW,IAA5C,CAAiDvC,CAAS,CAACe,cAA3D,EAA2EyB,IAA3E,CAAgF,SAAhF,IACH,CAFD,EAIA,KAAKT,OAAL,GAAeC,EAAf,CAAkBC,UAAYQ,MAA9B,CAAsC,UAAM,CACxC,CAAI,CAACC,OAAL,CAAa,EAAb,EACA,GAAI,CAAI,CAACd,eAAL,EAAwB,CAAI,CAACC,iBAA7B,EAAkD,CAAI,CAACC,sBAA3D,CAAmF,CAC/E,cAAQa,UAAuBC,aAA/B,CAA8C,CAC1CC,OAAO,CAAE,CAAI,CAACjB,eAD4B,CAE1CkB,SAAS,CAAE,CAAI,CAACjB,iBAF0B,CAG1CkB,cAAc,CAAE,CAAI,CAACjB,sBAHqB,CAA9C,CAKH,CACJ,CATD,EAWA,KAAKC,OAAL,GAAeC,EAAf,CAAkB,OAAlB,CAA2BhC,CAAS,CAACgB,OAArC,CAA8C,UAAM,CAChD,CAAI,CAACgC,IAAL,EACH,CAFD,EAIA,KAAKjB,OAAL,GAAeC,EAAf,CAAkB,OAAlB,CAA2BhC,CAAS,CAACQ,SAArC,CAAgD,SAACyC,CAAD,CAAO,CACnD,CAAI,CAACC,OAAL,CAAa,cAAED,CAAC,CAACE,aAAJ,EAAmBC,IAAnB,CAAwB,iBAAxB,CAAb,EACA,CAAI,CAACC,gBAAL,EACH,CAHD,EAKA,KAAKtB,OAAL,GAAeC,EAAf,CAAkB,OAAlB,CAA2BhC,CAAS,CAACS,SAArC,CAAgD,UAAM,CAClD,GAAM6C,CAAAA,CAAQ,CAAG,cAAEtD,CAAS,CAACQ,SAAZ,EAAuB+C,IAAvB,GAA8BH,IAA9B,CAAmC,iBAAnC,CAAjB,CACA,GAAI,CAAI,CAAC1B,IAAL,EAAa4B,CAAjB,CAA2B,OAC3B,CAAI,CAACJ,OAAL,CAAa,EAAE,CAAI,CAACxB,IAApB,EACA,CAAI,CAAC2B,gBAAL,EACH,CALD,EAOA,KAAKtB,OAAL,GAAeC,EAAf,CAAkB,OAAlB,CAA2BhC,CAAS,CAACU,SAArC,CAAgD,UAAM,CAClD,GAAiB,CAAb,EAAA,CAAI,CAACgB,IAAT,CAAoB,OACpB,CAAI,CAACwB,OAAL,CAAa,EAAE,CAAI,CAACxB,IAApB,EACA,CAAI,CAAC2B,gBAAL,EACH,CAJD,EAMA,KAAKtB,OAAL,GAAeC,EAAf,CAAkB,QAAlB,CAA4BhC,CAAS,CAACW,WAAtC,CAAmD,SAACsC,CAAD,CAAO,CACtDA,CAAC,CAACO,cAAF,GACA,CAAI,CAAChC,MAAL,CAAc,cAAExB,CAAS,CAACY,YAAZ,EAA0B6C,GAA1B,EAAd,CACA,CAAI,CAACP,OAAL,CAAa,CAAb,EACA,CAAI,CAACG,gBAAL,EACH,CALD,EAOA,KAAKtB,OAAL,GAAeC,EAAf,CAAkB,OAAlB,CAA2BhC,CAAS,CAACa,YAArC,CAAmD,UAAM,CACrD,CAAI,CAACW,MAAL,CAAc,EAAd,CACA,cAAExB,CAAS,CAACY,YAAZ,EAA0B6C,GAA1B,CAA8B,EAA9B,EACA,CAAI,CAACP,OAAL,CAAa,CAAb,EACA,CAAI,CAACG,gBAAL,EACH,CALD,EAOA,KAAKtB,OAAL,GAAeC,EAAf,CAAkB,QAAlB,CAA4BhC,CAAS,CAACc,IAAtC,CAA4C,SAACmC,CAAD,CAAO,CAC/CA,CAAC,CAACO,cAAF,GACA,CAAI,CAACN,OAAL,CAAa,CAAb,EACA,CAAI,CAACzB,IAAL,CAAY,cAAEwB,CAAC,CAACE,aAAJ,EAAmBM,GAAnB,EAAZ,CACA,CAAI,CAACJ,gBAAL,EACH,CALD,EAOA,KAAKtB,OAAL,GAAeC,EAAf,CAAkB,QAAlB,CAA4BhC,CAAS,CAACe,cAAtC,4CAAsD,WAAOkC,CAAP,6FAClD,cAAEjD,CAAS,CAACe,cAAZ,EAA4B2C,GAA5B,CAAgC,cAAET,CAAC,CAACE,aAAJ,CAAhC,EAAoDX,IAApD,CAAyD,SAAzD,KACA,cAAExC,CAAS,CAACgB,OAAZ,EAAqBwB,IAArB,CAA0B,UAA1B,CAAsC,CAAC,cAAES,CAAC,CAACE,aAAJ,EAAmBX,IAAnB,CAAwB,SAAxB,CAAvC,EACMmB,CAH4C,CAGpC,cAAEV,CAAC,CAACE,aAAJ,EAAmBS,OAAnB,CAA2B5D,CAAS,CAACG,KAArC,CAHoC,KAI9C,cAAE8C,CAAC,CAACE,aAAJ,EAAmBX,IAAnB,CAAwB,SAAxB,CAJ8C,kBAK9C,CAAI,CAACZ,eAAL,CAAuB+B,CAAK,CAACP,IAAN,CAAW,YAAX,CAAvB,CACA,CAAI,CAACvB,iBAAL,CAAyB8B,CAAK,CAACpB,IAAN,CAAWvC,CAAS,CAACI,UAArB,EAAiCiC,IAAjC,EAAzB,CACA,CAAI,CAACP,sBAAL,CAA8B6B,CAAK,CAACpB,IAAN,CAAWvC,CAAS,CAACK,eAArB,EAAsC+C,IAAtC,CAA2C,KAA3C,CAA9B,CAP8C,eAQd,iBAAU,gBAAV,CAA4B,eAA5B,CAA6C,CAAI,CAACvB,iBAAlD,CARc,QAQxCO,CARwC,QAS9C,cAAEpC,CAAS,CAACiB,mBAAZ,EAAiCoB,IAAjC,CAAsCD,CAAtC,EAT8C,wBAW9C,CAAI,CAACR,eAAL,CAAuB,IAAvB,CACA,CAAI,CAACC,iBAAL,CAAyB,IAAzB,CACA,CAAI,CAACC,sBAAL,CAA8B,IAA9B,CAb8C,gBAcd,iBAAU,mBAAV,CAA+B,eAA/B,CAdc,SAcxCM,CAdwC,QAe9C,cAAEpC,CAAS,CAACiB,mBAAZ,EAAiCoB,IAAjC,CAAsCD,CAAtC,EAf8C,yCAAtD,wDAmBH,C,0LAGsByB,WAAYC,kBAAZ,CAA+B,KAAKvC,SAApC,CAA+C,KAAKC,MAApD,CAA4D,KAAKC,IAAjE,CAAuE,KAAKC,IAA5E,CAAkF,KAAKC,MAAvF,C,QAAboC,C,QACAC,C,CAAgBC,UAAUC,MAAV,CAAiBhD,CAAS,CAACE,iBAA3B,CAA8C2C,CAA9C,C,CACtB,KAAKrB,OAAL,CAAasB,CAAb,E,qSAIMG,C,CAAUN,UAAYC,kBAAZ,CAA+B,KAAKvC,SAApC,CAA+C,KAAKC,MAApD,CAA4D,KAAKC,IAAjE,CAAuE,KAAKC,IAA5E,CAAkF,KAAKC,MAAvF,EACXyC,IADW,CACN,SAAAC,CAAQ,QAAI,CAAA,CAAI,CAACC,OAAL,CAAaD,CAAb,CAAuBnD,CAAS,CAACjB,uBAAjC,CAA0DD,CAAS,CAACC,uBAApE,CAAJ,CADF,EAEXmE,IAFW,CAEN,iBAAM,sCAAkB,CAAI,CAACxC,eAAvB,SAA4CW,IAA5C,CAAiDvC,CAAS,CAACe,cAA3D,EAA2EyB,IAA3E,CAAgF,SAAhF,IAAN,CAFM,EAGX+B,KAHW,CAGLC,UAAaC,SAHR,C,CAKhB,KAAKC,oBAAL,CAA0B1E,CAAS,CAACC,uBAApC,CAA6DkE,CAA7D,EACKI,KADL,CACWC,UAAaC,SADxB,E,6JAIIE,C,CAAW,CACf,KAAKjD,IAAL,CAAYiD,CAAZ,CACA,cAAE3E,CAAS,CAACO,SAAZ,EAAuBqE,WAAvB,CAAmC,QAAnC,EACA,GAAMC,CAAAA,CAAS,CAAG,cAAE7E,CAAS,CAACQ,SAAZ,EAAuBsE,MAAvB,8BAAmDH,CAAnD,QAAlB,CACAE,CAAS,CAACE,IAAV,CAAe,SAACC,CAAD,CAAQC,CAAR,CAAoB,CAC/B,cAAEA,CAAF,EAAWC,MAAX,GAAoBC,QAApB,CAA6B,QAA7B,CACH,CAFD,CAGH,C,kEAEoBC,C,CAAcjB,C,CAAS,CACxC,MAAOF,WAAUC,MAAV,CAAiBhD,CAAS,CAACC,eAA3B,CAA4C,EAA5C,EACFiD,IADE,CACG,SAACiB,CAAD,CAAU,CACZ,GAAMC,CAAAA,CAAW,CAAG,cAAED,CAAF,CAApB,CACA,cAAED,CAAF,EAAgBG,MAAhB,CAAuBD,CAAvB,EACAA,CAAW,CAACE,MAAZ,CAAmB,GAAnB,EAEA,MAAOC,WAAEC,IAAF,CAAOJ,CAAW,CAACnB,OAAZ,EAAP,CAA8BA,CAA9B,CACV,CAPE,EAQFC,IARE,CAQG,SAACkB,CAAD,CAAiB,CACnBA,CAAW,CAACK,OAAZ,CAAoB,GAApB,EACAL,CAAW,CAACM,MAAZ,EAGH,CAbE,CAcV,C,wCAEO7B,C,CAAM8B,C,CAAUT,C,CAAc,CAClC,MAAOnB,WAAUC,MAAV,CAAiB2B,CAAjB,CAA2B9B,CAA3B,EACNK,IADM,CACD,SAACiB,CAAD,CAAOS,CAAP,QAAc7B,WAAU8B,mBAAV,CAA8BX,CAA9B,CAA4CC,CAA5C,CAAkDS,CAAlD,CAAd,CADC,CAEV,C,2CAEgB,CACb,MAAO,kCACV,C,cAzJyCE,S,cA4J9C,GAAIC,CAAAA,CAAU,GAAd,CACA,GAAI,CAACA,CAAL,CAAiB,CACbC,UAAcC,QAAd,CAAuB9E,CAAgB,CAAC+E,OAAjB,EAAvB,CAAmD/E,CAAnD,CAAqE,kCAArE,EACA4E,CAAU,GACb,C","sourcesContent":["import $ from 'jquery';\nimport Notification from 'core/notification';\nimport Templates from 'core/templates';\nimport {get_string as getString} from 'core/str';\nimport {publish, subscribe} from 'core/pubsub';\n\nimport Modal from 'core/modal';\nimport ModalRegistry from 'core/modal_registry';\nimport ModalEvents from 'core/modal_events';\nimport ModalVideoPickerEvents from 'local_kaltura/modal_video_picker_events';\n\nimport KalturaAjax from 'local_kaltura/kaltura_ajax';\n\nconst SELECTORS = {\n    VIDEO_PICKER_ENTRY_LIST: '[data-region=\"video-picker-entry-list\"]',\n    ENTRY_LIST: '[data-region=\"entry-list\"]',\n    ENTRY: '[data-entry]',\n    ENTRY_NAME: '[data-region=\"entry-name\"]',\n    ENTRY_THUMBNAIL: '[data-region=\"entry-thumbnail\"]',\n    PAGING_BAR: '[data-region=\"paging-bar\"]',\n    PAGE_ITEM: '.page-item',\n    PAGE_LINK: '[data-region=\"paging-bar\"] [data-action=\"switch-page\"]',\n    NEXT_PAGE: '[data-action=\"next-page\"]',\n    PREV_PAGE: '[data-action=\"prev-page\"]',\n    SEARCH_FORM: '[data-action=\"kaltura-search\"]',\n    SEARCH_INPUT: '#kaltura_search_box',\n    SEARCH_CLEAR: '[data-action=\"kaltura-clear-search\"]',\n    SORT: '#kaltura_sort',\n    ENTRY_CHECKBOX: '.kaltura-entry-checkbox',\n    CONFIRM: '[data-action=\"confirm-entry-selection\"]',\n    SELECTED_ENTRY_NAME: '[data-region=\"selected_entry_name\"]'\n};\n\nconst TEMPLATES = {\n    OVERLAY_LOADING: 'core/overlay_loading',\n    VIDEO_PICKER_BODY: 'local_kaltura/modal_video_picker_body',\n    VIDEO_PICKER_ENTRY_LIST: 'local_kaltura/modal_video_picker_entry_list'\n};\n\nexport default class ModalVideoPicker extends Modal {\n\n    constructor(root) {\n        super(root);\n        this.contextid = null;\n        this.search = '';\n        this.sort = 'recent';\n        this.page = 0;\n        this.source = 1;\n        this.selectedEntryId = null;\n        this.selectedEntryName = null;\n        this.selectedEntryThumbnail = null;\n    }\n\n    registerEventListeners() {\n        super.registerEventListeners();\n\n        this.getRoot().on(ModalEvents.shown, async () => {\n            this.renderBody();\n            if (this.selectedEntryId && this.selectedEntryName && this.selectedEntryThumbnail) {\n                const selectedEntryText = await getString('selected_entry', 'local_kaltura', this.selectedEntryName);\n                $(SELECTORS.SELECTED_ENTRY_NAME).text(selectedEntryText);\n            }\n        });\n\n        this.getRoot().on(ModalEvents.bodyRendered, () => {\n            $(`[data-entry=\"${this.selectedEntryId}\"]`).find(SELECTORS.ENTRY_CHECKBOX).prop('checked', true);\n        });\n\n        this.getRoot().on(ModalEvents.hidden, () => {\n            this.setBody('');\n            if (this.selectedEntryId && this.selectedEntryName && this.selectedEntryThumbnail) {\n                publish(ModalVideoPickerEvents.entrySelected, {\n                    entryId: this.selectedEntryId,\n                    entryName: this.selectedEntryName,\n                    entryThumbnail: this.selectedEntryThumbnail\n                });\n            }\n        });\n\n        this.getRoot().on('click', SELECTORS.CONFIRM, () => {\n            this.hide();\n        });\n\n        this.getRoot().on('click', SELECTORS.PAGE_LINK, (e) => {\n            this.setPage($(e.currentTarget).attr('data-page-index'));\n            this.refreshEntryList();\n        });\n\n        this.getRoot().on('click', SELECTORS.NEXT_PAGE, () => {\n            const lastPage = $(SELECTORS.PAGE_LINK).last().attr('data-page-index');\n            if (this.page == lastPage) return;\n            this.setPage(++this.page);\n            this.refreshEntryList();\n        });\n\n        this.getRoot().on('click', SELECTORS.PREV_PAGE, () => {\n            if (this.page == 0) return;\n            this.setPage(--this.page);\n            this.refreshEntryList();\n        });\n\n        this.getRoot().on('submit', SELECTORS.SEARCH_FORM, (e) => {\n            e.preventDefault();\n            this.search = $(SELECTORS.SEARCH_INPUT).val();\n            this.setPage(0);\n            this.refreshEntryList();\n        });\n\n        this.getRoot().on('click', SELECTORS.SEARCH_CLEAR, () => {\n            this.search = '';\n            $(SELECTORS.SEARCH_INPUT).val('');\n            this.setPage(0);\n            this.refreshEntryList();\n        });\n\n        this.getRoot().on('change', SELECTORS.SORT, (e) => {\n            e.preventDefault();\n            this.setPage(0);\n            this.sort = $(e.currentTarget).val();\n            this.refreshEntryList();\n        });\n\n        this.getRoot().on('change', SELECTORS.ENTRY_CHECKBOX, async (e) => {\n            $(SELECTORS.ENTRY_CHECKBOX).not($(e.currentTarget)).prop('checked', false);\n            $(SELECTORS.CONFIRM).prop('disabled', !$(e.currentTarget).prop('checked'));\n            const entry = $(e.currentTarget).closest(SELECTORS.ENTRY);\n            if ($(e.currentTarget).prop('checked')) {\n                this.selectedEntryId = entry.attr('data-entry');\n                this.selectedEntryName = entry.find(SELECTORS.ENTRY_NAME).text();\n                this.selectedEntryThumbnail = entry.find(SELECTORS.ENTRY_THUMBNAIL).attr('src');\n                const selectedEntryText = await getString('selected_entry', 'local_kaltura', this.selectedEntryName);\n                $(SELECTORS.SELECTED_ENTRY_NAME).text(selectedEntryText);\n            } else {\n                this.selectedEntryId = null;\n                this.selectedEntryName = null;\n                this.selectedEntryThumbnail = null;\n                const selectedEntryText = await getString('no_selected_entry', 'local_kaltura');\n                $(SELECTORS.SELECTED_ENTRY_NAME).text(selectedEntryText);\n            }\n        });\n\n    }\n\n    async renderBody() {\n        const data = await KalturaAjax.getVideoPickerData(this.contextid, this.search, this.sort, this.page, this.source);\n        const renderPromise = Templates.render(TEMPLATES.VIDEO_PICKER_BODY, data);\n        this.setBody(renderPromise);\n    }\n\n    async refreshEntryList() {\n        const promise = KalturaAjax.getVideoPickerData(this.contextid, this.search, this.sort, this.page, this.source)\n            .then(response => this.replace(response, TEMPLATES.VIDEO_PICKER_ENTRY_LIST, SELECTORS.VIDEO_PICKER_ENTRY_LIST))\n            .then(() => $(`[data-entry=\"${this.selectedEntryId}\"]`).find(SELECTORS.ENTRY_CHECKBOX).prop('checked', true))\n            .catch(Notification.exception);\n\n        this.loadUntilPromiseDone(SELECTORS.VIDEO_PICKER_ENTRY_LIST, promise)\n            .catch(Notification.exception);\n    }\n\n    setPage(pageIndex) {\n        this.page = pageIndex;\n        $(SELECTORS.PAGE_ITEM).removeClass('active');\n        const pageLinks = $(SELECTORS.PAGE_LINK).filter(`[data-page-index=\"${pageIndex}\"]`);\n        pageLinks.each((index, element) => {\n            $(element).parent().addClass('active');\n        });\n    }\n\n    loadUntilPromiseDone(areaSelector, promise) {\n        return Templates.render(TEMPLATES.OVERLAY_LOADING, {})\n            .then((html) => {\n                const loadingIcon = $(html);\n                $(areaSelector).append(loadingIcon);\n                loadingIcon.fadeIn(150);\n\n                return $.when(loadingIcon.promise(), promise);\n            })\n            .then((loadingIcon) => {\n                loadingIcon.fadeOut(100);\n                loadingIcon.remove();\n\n                return;\n            });\n    }\n\n    replace(data, template, areaSelector) {\n        return Templates.render(template, data)\n        .then((html, js) => Templates.replaceNodeContents(areaSelector, html, js));\n    }\n\n    static getType() {\n        return 'local_kaltura_modal_video_picker';\n    }\n}\n\nlet registered = false;\nif (!registered) {\n    ModalRegistry.register(ModalVideoPicker.getType(), ModalVideoPicker, 'local_kaltura/modal_video_picker');\n    registered = true;\n}\n"],"file":"modal_video_picker.min.js"}