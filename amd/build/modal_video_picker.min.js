define ("local_kaltura/modal_video_picker",["exports","jquery","core/ajax","core/notification","core/templates","core/str","core/modal","core/modal_registry","core/modal_events","local_kaltura/kaltura_ajax"],function(a,b,c,d,e,f,g,h,i,j){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.default=void 0;b=k(b);c=k(c);d=k(d);e=k(e);g=k(g);h=k(h);i=k(i);j=k(j);function k(a){return a&&a.__esModule?a:{default:a}}function l(a){if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){l=function(a){return typeof a}}else{l=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return l(a)}function m(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){c(a);return}if(h.done){b(i)}else{Promise.resolve(i).then(d,e)}}function n(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){var h=a.apply(b,c);function f(a){m(h,d,e,f,g,"next",a)}function g(a){m(h,d,e,f,g,"throw",a)}f(void 0)})}}function o(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function p(a,b){for(var c=0,d;c<b.length;c++){d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;if("value"in d)d.writable=!0;Object.defineProperty(a,d.key,d)}}function q(a,b,c){if(b)p(a.prototype,b);if(c)p(a,c);return a}function r(a,b){if(b&&("object"===l(b)||"function"==typeof b)){return b}return s(a)}function s(a){if(void 0===a){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return a}function t(a,b,c){if("undefined"!=typeof Reflect&&Reflect.get){t=Reflect.get}else{t=function(a,b,c){var d=u(a,b);if(!d)return;var e=Object.getOwnPropertyDescriptor(d,b);if(e.get){return e.get.call(c)}return e.value}}return t(a,b,c||a)}function u(a,b){while(!Object.prototype.hasOwnProperty.call(a,b)){a=v(a);if(null===a)break}return a}function v(a){v=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)};return v(a)}function w(a,b){if("function"!=typeof b&&null!==b){throw new TypeError("Super expression must either be null or a function")}a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}});if(b)x(a,b)}function x(a,b){x=Object.setPrototypeOf||function(a,b){a.__proto__=b;return a};return x(a,b)}var y={VIDEO_PICKER_MAIN:"[data-region=\"video-picker-main\"]",ENTRY_LIST:"[data-region=\"entry-list\"]",ENTRY:"[data-entry]",PAGING_BAR:"[data-region=\"paging-bar\"]",PAGE_ITEM:".page-item",PAGE_LINK:"[data-region=\"paging-bar\"] [data-action=\"switch-page\"]",NEXT_PAGE:"[data-action=\"next-page\"]",PREV_PAGE:"[data-action=\"prev-page\"]",SEARCH_FORM:"[data-action=\"kaltura-search\"]",SEARCH_INPUT:"#kaltura_search_box",SEARCH_CLEAR:"[data-action=\"kaltura-clear-search\"]",SORT:"#kaltura_sort",ENTRY_CHECKBOX:".kaltura-entry-checkbox",CONFIRM:"[data-action=\"confirm-entry-selection\"]",ENTRY_ID:"#entry_id",ENTRY_NAME:"#id_name",ENTRY_THUMB:"#media_thumbnail",ENTRY_SELECTED_HDR:"[data-region=\"selected-entry-header\"]",VIDEO_TITLE:"#video_title"},z={OVERLAY_LOADING:"core/overlay_loading",VIDEO_PICKER_MAIN:"local_kaltura/modal_video_picker_main"},A=function(a){w(g,a);function g(a){var b;o(this,g);b=r(this,v(g).call(this,a));b.contextid=null;b.search="";b.sort="recent";b.page=0;b.source=1;b.selectedEntryId=null;b.selectedEntryName=null;b.selectedEntryThumb=null;return b}q(g,[{key:"registerEventListeners",value:function registerEventListeners(){var a=this;t(v(g.prototype),"registerEventListeners",this).call(this);this.getRoot().on(i.default.shown,function(){a.refreshModal()});this.getRoot().on(i.default.hidden,function(){(0,b.default)(y.VIDEO_PICKER_MAIN).html("");a.reset();if(a.selectedEntryId&&a.selectedEntryName&&a.selectedEntryThumb){a.setSelectedEntry(a.selectedEntryId,a.selectedEntryName,a.selectedEntryThumb)}});this.getRoot().on("click",y.PAGE_LINK,function(c){a.setPage((0,b.default)(c.currentTarget).attr("data-page-index"));a.refreshModal()});this.getRoot().on("click",y.NEXT_PAGE,function(){var c=(0,b.default)(y.PAGE_LINK).last().attr("data-page-index");if(a.page==c)return;a.setPage(++a.page);a.refreshModal()});this.getRoot().on("click",y.PREV_PAGE,function(){if(0==a.page)return;a.setPage(--a.page);a.refreshModal()});this.getRoot().on("submit",y.SEARCH_FORM,function(c){c.preventDefault();a.search=(0,b.default)(y.SEARCH_INPUT).val();a.setPage(0);a.refreshModal()});this.getRoot().on("click",y.SEARCH_CLEAR,function(){a.search="";(0,b.default)(y.SEARCH_INPUT).val("");a.setPage(0);a.refreshModal()});this.getRoot().on("change",y.SORT,function(c){c.preventDefault();a.setPage(0);a.sort=(0,b.default)(c.currentTarget).val();a.refreshModal()});this.getRoot().on("change",y.ENTRY_CHECKBOX,function(c){(0,b.default)(y.ENTRY_CHECKBOX).not((0,b.default)(c.currentTarget)).prop("checked",!1);(0,b.default)(y.CONFIRM).prop("disabled",!(0,b.default)(c.currentTarget).prop("checked"));if((0,b.default)(c.currentTarget).prop("checked")){var d=(0,b.default)(c.currentTarget).closest(y.ENTRY),e=d.attr("data-entry"),f=d.find(".card-title").text(),g=d.find("img").attr("src");a.selectedEntryId=e;a.selectedEntryName=f;a.selectedEntryThumb=g}else{a.selectedEntryId=null;a.selectedEntryName=null;a.selectedEntryThumb=null}});this.getRoot().on("click",y.CONFIRM,function(){a.setSelectedEntry(a.selectedEntryId,a.selectedEntryName,a.selectedEntryThumb);a.hide()})}},{key:"setPage",value:function setPage(a){this.page=a;(0,b.default)(y.PAGE_ITEM).removeClass("active");var c=(0,b.default)(y.PAGE_LINK).filter("[data-page-index=\"".concat(a,"\"]"));c.each(function(a,c){(0,b.default)(c).parent().addClass("active")})}},{key:"refreshModal",value:function(){var a=n(regeneratorRuntime.mark(function a(){var e=this,f;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:f=c.default.call([j.default.getVideoPickerData(this.contextid,this.search,this.sort,this.page,this.source)]);f[0].then(function(a){return e.replace(a,z.VIDEO_PICKER_MAIN,y.VIDEO_PICKER_MAIN)}).then(function(){return(0,b.default)("[data-entry=\"".concat(e.selectedEntryId,"\"]")).find(y.ENTRY_CHECKBOX).prop("checked",!0)}).catch(d.default.exception);this.loadUntilPromisesDone(y.VIDEO_PICKER_MAIN,f).catch(d.default.exception);case 3:case"end":return a.stop();}}},a,this)}));return function refreshModal(){return a.apply(this,arguments)}}()},{key:"loadUntilPromisesDone",value:function loadUntilPromisesDone(a,c){return e.default.render(z.OVERLAY_LOADING,{}).then(function(d){var e=(0,b.default)(d);(0,b.default)(a).append(e);e.fadeIn(150);return b.default.when(e.promise(),Promise.all(c))}).then(function(a){a.fadeOut(100);a.remove()})}},{key:"setSelectedEntry",value:function setSelectedEntry(a,c,d){(0,b.default)(y.ENTRY_ID).val(a);(0,b.default)(y.ENTRY_NAME).val(c);(0,b.default)(y.ENTRY_THUMB).attr("src",d);(0,b.default)(y.VIDEO_TITLE).val(c);(0,f.get_string)("selected_entry","local_kaltura",c).then(function(a){return(0,b.default)(y.ENTRY_SELECTED_HDR).text(a)})}},{key:"replace",value:function replace(a,b,c){return e.default.render(b,a).then(function(a,b){return e.default.replaceNodeContents(c,a,b)})}},{key:"reset",value:function reset(){this.search="";(0,b.default)(y.SEARCH_INPUT).val("");this.sort="recent";(0,b.default)(y.SORT).prop("selectedIndex",0);this.setPage(0);this.source=1}}],[{key:"getType",value:function getType(){return"local_kaltura_modal_video_picker"}}]);return g}(g.default);a.default=A;var B=!1;if(!B){h.default.register(A.getType(),A,"local_kaltura/modal_video_picker");B=!0}return a.default});
//# sourceMappingURL=modal_video_picker.min.js.map
