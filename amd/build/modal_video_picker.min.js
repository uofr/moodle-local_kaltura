define ("local_kaltura/modal_video_picker",["exports","jquery","core/notification","core/templates","core/str","core/pubsub","core/modal","core/modal_registry","core/modal_events","local_kaltura/modal_video_picker_events","local_kaltura/kaltura_ajax"],function(a,b,c,d,f,g,h,i,j,k,l){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.default=void 0;b=m(b);c=m(c);d=m(d);h=m(h);i=m(i);j=m(j);k=m(k);l=m(l);function m(a){return a&&a.__esModule?a:{default:a}}function n(a){if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){n=function(a){return typeof a}}else{n=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return n(a)}function o(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){c(a);return}if(h.done){b(i)}else{Promise.resolve(i).then(d,e)}}function p(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){var h=a.apply(b,c);function f(a){o(h,d,e,f,g,"next",a)}function g(a){o(h,d,e,f,g,"throw",a)}f(void 0)})}}function q(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function r(a,b){for(var c=0,d;c<b.length;c++){d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;if("value"in d)d.writable=!0;Object.defineProperty(a,d.key,d)}}function s(a,b,c){if(b)r(a.prototype,b);if(c)r(a,c);return a}function t(a,b){if(b&&("object"===n(b)||"function"==typeof b)){return b}return u(a)}function u(a){if(void 0===a){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return a}function v(a,b,c){if("undefined"!=typeof Reflect&&Reflect.get){v=Reflect.get}else{v=function(a,b,c){var d=w(a,b);if(!d)return;var e=Object.getOwnPropertyDescriptor(d,b);if(e.get){return e.get.call(c)}return e.value}}return v(a,b,c||a)}function w(a,b){while(!Object.prototype.hasOwnProperty.call(a,b)){a=x(a);if(null===a)break}return a}function x(a){x=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)};return x(a)}function y(a,b){if("function"!=typeof b&&null!==b){throw new TypeError("Super expression must either be null or a function")}a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}});if(b)z(a,b)}function z(a,b){z=Object.setPrototypeOf||function(a,b){a.__proto__=b;return a};return z(a,b)}var A={VIDEO_PICKER_ENTRY_LIST:"[data-region=\"video-picker-entry-list\"]",ENTRY_LIST:"[data-region=\"entry-list\"]",ENTRY:"[data-entry]",ENTRY_NAME:"[data-region=\"entry-name\"]",ENTRY_THUMBNAIL:"[data-region=\"entry-thumbnail\"]",PAGING_BAR:"[data-region=\"paging-bar\"]",PAGE_ITEM:".page-item",PAGE_LINK:"[data-region=\"paging-bar\"] [data-action=\"switch-page\"]",NEXT_PAGE:"[data-action=\"next-page\"]",PREV_PAGE:"[data-action=\"prev-page\"]",SEARCH_FORM:"[data-action=\"kaltura-search\"]",SEARCH_INPUT:"#kaltura_search_box",SEARCH_CLEAR:"[data-action=\"kaltura-clear-search\"]",SORT:"#kaltura_sort",SWITCH_TAB:"[data-action=\"switch-tab\"]",ENTRY_CHECKBOX:".kaltura-entry-checkbox",CONFIRM:"[data-action=\"confirm-entry-selection\"]",SELECTED_ENTRY_NAME:"[data-region=\"selected_entry_name\"]"},B={OVERLAY_LOADING:"core/overlay_loading",VIDEO_PICKER_BODY:"local_kaltura/modal_video_picker_body",VIDEO_PICKER_ENTRY_LIST:"local_kaltura/modal_video_picker_entry_list"},C=function(a){y(e,a);function e(a){var b;q(this,e);b=t(this,x(e).call(this,a));b.contextid=null;b.search="";b.sort="recent";b.page=0;b.source=1;b.hasCe=!1;b.selectedEntryId=null;b.selectedEntryName=null;b.selectedEntryThumbnail=null;return b}s(e,[{key:"registerEventListeners",value:function registerEventListeners(){var a=this;v(x(e.prototype),"registerEventListeners",this).call(this);this.getRoot().on(j.default.shown,p(regeneratorRuntime.mark(function c(){var d;return regeneratorRuntime.wrap(function(c){while(1){switch(c.prev=c.next){case 0:a.renderBody();if(!(a.selectedEntryId&&a.selectedEntryName&&a.selectedEntryThumbnail)){c.next=7;break}c.next=4;return(0,f.get_string)("selected_entry","local_kaltura",a.selectedEntryName);case 4:d=c.sent;(0,b.default)(A.SELECTED_ENTRY_NAME).text(d);(0,b.default)(A.CONFIRM).prop("disabled",!1);case 7:case"end":return c.stop();}}},c)})));this.getRoot().on(j.default.bodyRendered,function(){(0,b.default)("[data-entry=\"".concat(a.selectedEntryId,"\"]")).find(A.ENTRY_CHECKBOX).prop("checked",!0)});this.getRoot().on(j.default.hidden,function(){if(a.selectedEntryId&&a.selectedEntryName&&a.selectedEntryThumbnail){(0,g.publish)(k.default.entrySelected,{entryId:a.selectedEntryId,entryName:a.selectedEntryName,entryThumbnail:a.selectedEntryThumbnail})}a.setBody("");a.search="";a.sort="recent";a.page=0;a.source=1});this.getRoot().on("click",A.CONFIRM,function(){a.hide()});this.getRoot().on("click",A.PAGE_LINK,function(c){var d=(0,b.default)(c.currentTarget).attr("data-page-index");if(a.page===d)return;a.setPage(d);a.refreshEntryList()});this.getRoot().on("click",A.NEXT_PAGE,function(){var c=(0,b.default)(A.PAGE_LINK).last().attr("data-page-index");if(a.page==c)return;a.setPage(++a.page);a.refreshEntryList()});this.getRoot().on("click",A.PREV_PAGE,function(){if(0==a.page)return;a.setPage(--a.page);a.refreshEntryList()});this.getRoot().on("submit",A.SEARCH_FORM,function(c){c.preventDefault();a.search=(0,b.default)(A.SEARCH_INPUT).val();a.setPage(0);a.refreshEntryList()});this.getRoot().on("click",A.SEARCH_CLEAR,function(){a.search="";(0,b.default)(A.SEARCH_INPUT).val("");a.setPage(0);a.refreshEntryList()});this.getRoot().on("change",A.SORT,function(c){c.preventDefault();a.setPage(0);a.sort=(0,b.default)(c.currentTarget).val();a.refreshEntryList()});this.root.on("click",A.SWITCH_TAB,function(c){a.page=0;a.resetSearch();a.resetSort();a.source=parseInt((0,b.default)(c.currentTarget).attr("data-source"));a.refreshEntryList()});this.getRoot().on("change",A.ENTRY_CHECKBOX,function(){var c=p(regeneratorRuntime.mark(function c(d){var e,g,h;return regeneratorRuntime.wrap(function(c){while(1){switch(c.prev=c.next){case 0:(0,b.default)(A.ENTRY_CHECKBOX).not((0,b.default)(d.currentTarget)).prop("checked",!1);(0,b.default)(A.CONFIRM).prop("disabled",!(0,b.default)(d.currentTarget).prop("checked"));e=(0,b.default)(d.currentTarget).closest(A.ENTRY);if(!(0,b.default)(d.currentTarget).prop("checked")){c.next=13;break}a.selectedEntryId=e.attr("data-entry");a.selectedEntryName=e.find(A.ENTRY_NAME).text();a.selectedEntryThumbnail=e.find(A.ENTRY_THUMBNAIL).attr("src");c.next=9;return(0,f.get_string)("selected_entry","local_kaltura",a.selectedEntryName);case 9:g=c.sent;(0,b.default)(A.SELECTED_ENTRY_NAME).text(g);c.next=20;break;case 13:a.selectedEntryId=null;a.selectedEntryName=null;a.selectedEntryThumbnail=null;c.next=18;return(0,f.get_string)("no_selected_entry","local_kaltura");case 18:h=c.sent;(0,b.default)(A.SELECTED_ENTRY_NAME).text(h);case 20:case"end":return c.stop();}}},c)}));return function(){return c.apply(this,arguments)}}())}},{key:"resetSearch",value:function resetSearch(){(0,b.default)(A.SEARCH_INPUT).val("");this.search=""}},{key:"resetSort",value:function resetSort(){(0,b.default)(A.SORT).val("recent");this.sort="recent"}},{key:"renderBody",value:function(){var a=p(regeneratorRuntime.mark(function a(){var b,c;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:a.next=2;return l.default.getVideoPickerData(this.contextid,this.search,this.sort,this.page,this.source,this.hasCe);case 2:b=a.sent;c=d.default.render(B.VIDEO_PICKER_BODY,b);this.setBody(c);case 5:case"end":return a.stop();}}},a,this)}));return function renderBody(){return a.apply(this,arguments)}}()},{key:"refreshEntryList",value:function(){var a=p(regeneratorRuntime.mark(function a(){var d=this,e;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:e=l.default.getVideoPickerData(this.contextid,this.search,this.sort,this.page,this.source,this.hasCe).then(function(a){return d.replace(a,B.VIDEO_PICKER_ENTRY_LIST,A.VIDEO_PICKER_ENTRY_LIST)}).then(function(){return(0,b.default)("[data-entry=\"".concat(d.selectedEntryId,"\"]")).find(A.ENTRY_CHECKBOX).prop("checked",!0)}).catch(c.default.exception);this.loadUntilPromiseDone(this.getModal(),e).catch(c.default.exception);case 2:case"end":return a.stop();}}},a,this)}));return function refreshEntryList(){return a.apply(this,arguments)}}()},{key:"setPage",value:function setPage(a){this.page=a;(0,b.default)(A.PAGE_ITEM).removeClass("active");var c=(0,b.default)(A.PAGE_LINK).filter("[data-page-index=\"".concat(a,"\"]"));c.each(function(a,c){(0,b.default)(c).parent().addClass("active")})}},{key:"loadUntilPromiseDone",value:function loadUntilPromiseDone(a,c){return d.default.render(B.OVERLAY_LOADING,{}).then(function(d){var e=(0,b.default)(d);a.append(e);e.fadeIn(150);return b.default.when(e.promise(),c)}).then(function(a){a.fadeOut(100);a.remove()})}},{key:"replace",value:function replace(a,b,c){return d.default.render(b,a).then(function(a,b){return d.default.replaceNodeContents(c,a,b)})}}],[{key:"getType",value:function getType(){return"local_kaltura_modal_video_picker"}}]);return e}(h.default);a.default=C;var D=!1;if(!D){i.default.register(C.getType(),C,"local_kaltura/modal_video_picker");D=!0}return a.default});
//# sourceMappingURL=modal_video_picker.min.js.map
